This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
eslint.config.js
index.html
package.json
public/vite.svg
README.md
robynne-o-HOrhCnQsxnQ-unsplash.jpg
src/App.css
src/App.jsx
src/assets/react.svg
src/Auth.css
src/components/BarChartCard.jsx
src/components/Card.jsx
src/components/DashboardCard.jsx
src/components/DataTable.jsx
src/components/DonutProgress.jsx
src/components/EmptyState.jsx
src/components/FileUpload.jsx
src/components/IconPillButton.jsx
src/components/Layout.css
src/components/Layout.jsx
src/components/Navbar.jsx
src/components/PageHeader.jsx
src/components/Pagination.jsx
src/components/PieChartCard.jsx
src/components/ProtectedRoute.jsx
src/components/SearchInput.jsx
src/components/Sidebar.css
src/components/Sidebar.jsx
src/components/SparklineMini.jsx
src/components/StatCard.jsx
src/components/Toolbar.jsx
src/context/AuthContext.jsx
src/context/ThemeContext.jsx
src/index.css
src/main.jsx
src/pages/accounts/AccountsInvoices.jsx
src/pages/accounts/AccountsNotes.jsx
src/pages/accounts/AccountsReports.jsx
src/pages/Admin.jsx
src/pages/Campaigns.jsx
src/pages/Dashboard.jsx
src/pages/dashboards/AccountsDashboard.jsx
src/pages/dashboards/AdminDashboard.jsx
src/pages/dashboards/DashboardLayout.css
src/pages/dashboards/DealerDashboard.jsx
src/pages/dashboards/InventoryDashboard.jsx
src/pages/dashboards/ManagerDashboard.css
src/pages/dashboards/ManagerDashboard.jsx
src/pages/Documents.jsx
src/pages/InvoiceDetail.jsx
src/pages/Invoices.jsx
src/pages/Login.jsx
src/pages/OTPVerify.jsx
src/pages/Reports.jsx
src/services/api.js
src/services/socket.js
src/theme.js
src/utils/formatters.js
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?


.github/instructions/kluster-code-verify.instructions.md
.kluster
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs['recommended-latest'],
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>dealer-portal-react</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="README.md">
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is enabled on this template. See [this documentation](https://react.dev/learn/react-compiler) for more information.

Note: This will impact Vite dev & build performances.

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/Auth.css">
body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(180deg, #8ec5fc 0%, #e0c3fc 100%);
  background-image: url('../assets/mountain-bg.jpg'); /* optional background image */
  background-size: cover;
  background-position: center;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

.auth-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
}

.auth-box {
  width: 380px;
  padding: 2rem 2.5rem;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(10px);
  border-radius: 15px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.2);
  text-align: center;
  color: #fff;
}

h2 {
  margin-bottom: 1rem;
  letter-spacing: 1px;
}

.input-group {
  margin-bottom: 1rem;
}

input {
  width: 100%;
  padding: 10px 12px;
  border: none;
  border-radius: 8px;
  outline: none;
  background: rgba(255, 255, 255, 0.3);
  color: #fff;
  font-size: 14px;
}

input::placeholder {
  color: #e5e5e5;
}

.auth-btn {
  width: 100%;
  padding: 10px;
  border: none;
  border-radius: 8px;
  background: linear-gradient(135deg, #56ccf2, #2f80ed);
  color: white;
  cursor: pointer;
  transition: 0.3s ease;
}

.auth-btn:hover {
  transform: scale(1.03);
}

.extra-options {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 13px;
  margin-bottom: 1rem;
}

a {
  color: #fff;
  text-decoration: underline;
  cursor: pointer;
}

.register-text {
  font-size: 13px;
  margin-top: 1rem;
}

.error-text {
  color: #ff5e5e;
  margin-bottom: 0.8rem;
}
</file>

<file path="src/components/BarChartCard.jsx">
import React from "react";
import { Card, CardContent, Typography } from "@mui/material";
import { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, CartesianGrid } from "recharts";

export default function BarChartCard({ title, data, xKey, yKey, color = "#1976d2" }) {
  return (
    <Card sx={{ borderRadius: 3, boxShadow: 2, p: 2 }}>
      <CardContent>
        <Typography variant="subtitle1" gutterBottom>{title}</Typography>
        <ResponsiveContainer width="100%" height={250}>
          <BarChart data={data}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey={xKey} />
            <YAxis />
            <Tooltip />
            <Bar dataKey={yKey} fill={color} radius={[6, 6, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/components/Card.jsx">
import React from "react";

export default function Card({ title, children, footer, style }) {
  return (
    <div className="card" style={style}>
      {title && (
        <h3 style={{ marginTop: 0, marginBottom: "0.75rem" }}>{title}</h3>
      )}
      {children}
      {footer && <div style={{ marginTop: "0.75rem" }}>{footer}</div>}
    </div>
  );
}
</file>

<file path="src/components/DashboardCard.jsx">
import React from "react";
import { Card, CardContent, Typography, Box } from "@mui/material";

export default function DashboardCard({ title, value, icon, color = "primary.main" }) {
  return (
    <Card sx={{
      borderRadius: 3,
      boxShadow: 2,
      p: 2,
      backgroundColor: "background.paper",
      transition: "transform 0.2s ease",
      "&:hover": { transform: "translateY(-4px)", boxShadow: 4 },
    }}>
      <CardContent>
        <Box display="flex" alignItems="center" justifyContent="space-between">
          <Typography variant="subtitle2" color="text.secondary">
            {title}
          </Typography>
          <Box color={color}>{icon}</Box>
        </Box>
        <Typography variant="h5" sx={{ mt: 1, fontWeight: "bold" }}>
          {value}
        </Typography>
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/components/DataTable.jsx">
import React from "react";

export default function DataTable({ columns, rows, emptyMessage = "No data available" }) {
  if (!rows || rows.length === 0) {
    return <p style={{ color: "#94a3b8" }}>{emptyMessage}</p>;
  }
  return (
    <div style={{ overflowX: "auto" }}>
      <table style={{ width: "100%", borderCollapse: "collapse" }}>
        <thead>
          <tr>
            {columns.map((c) => (
              <th key={c.key} style={{ textAlign: "left", padding: "0.6rem", borderBottom: "1px solid rgba(255,255,255,0.1)", color: "#cbd5e1", fontWeight: 600 }}>
                {c.label}
              </th>
            ))}
          </tr>
        </thead>
        <tbody>
          {rows.map((row, idx) => (
            <tr key={row.id || idx} style={{ background: idx % 2 === 1 ? "rgba(255,255,255,0.02)" : "transparent" }}>
              {columns.map((c) => (
                <td key={c.key} style={{ padding: "0.6rem", borderBottom: "1px solid rgba(255,255,255,0.06)" }}>
                  {typeof c.render === "function" ? c.render(row[c.key], row) : row[c.key]}
                </td>
              ))}
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
</file>

<file path="src/components/EmptyState.jsx">
import React from "react";

export default function EmptyState({ icon = "üîç", title = "No data", description }) {
  return (
    <div style={{ textAlign: "center", padding: "1.5rem", color: "#94a3b8" }}>
      <div style={{ fontSize: "2rem" }}>{icon}</div>
      <div style={{ fontWeight: 600, marginTop: "0.25rem", color: "#cbd5e1" }}>{title}</div>
      {description && <div style={{ marginTop: "0.25rem" }}>{description}</div>}
    </div>
  );
}
</file>

<file path="src/components/Layout.css">
/* ========== OVERALL LAYOUT ========== */
.app-layout {
  display: flex;
  height: 100vh;
  background: var(--bg-glow), var(--bg-base);
  color: var(--text-color);
  overflow: hidden;
}

/* ========== SIDEBAR ========== */
.app-layout aside {
  position: fixed;
  left: 0;
  top: 0;
  bottom: 0;
  width: 240px;
  transition: width 0.3s ease;
  z-index: 1000;
}

/* ========== MAIN CONTENT AREA ========== */
.main-content {
  flex: 1;
  margin-left: 240px;
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
}

/* ========== NAVBAR ========== */
.main-content nav {
  position: sticky;
  top: 0;
  z-index: 100;
}

/* ========== MAIN PAGE CONTENT ========== */
.page-content {
  flex: 1;
  overflow-y: auto;
  padding: 2rem;
  background: var(--bg-base);
}

/* ========== CONTENT WRAPPER (DASHBOARDS) ========== */
.content-wrapper {
  background: var(--card-bg);
  border-radius: 20px;
  border: 1px solid var(--card-border);
  padding: 2rem;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(12px);
  min-height: calc(100vh - 110px); /* adjusts for navbar height */
}

/* ========== RESPONSIVE ========== */
@media (max-width: 900px) {
  .app-layout aside {
    width: 70px;
  }

  .main-content {
    margin-left: 70px;
  }
}
</file>

<file path="src/components/SearchInput.jsx">
import React from "react";

export default function SearchInput({ placeholder = "Search", value, onChange, style }) {
  return (
    <div
      style={{
        display: "flex",
        alignItems: "center",
        gap: "0.5rem",
        padding: "0.6rem 0.9rem",
        borderRadius: 9999,
        background: "rgba(255,255,255,0.06)",
        border: "1px solid rgba(255,255,255,0.08)",
        boxShadow: "inset 0 0 10px rgba(0,0,0,0.2)",
        color: "#cbd5e1",
        ...style,
      }}
    >
      <span style={{ opacity: 0.8 }}>üîé</span>
      <input
        value={value}
        onChange={onChange}
        placeholder={placeholder}
        style={{
          outline: "none",
          border: "none",
          background: "transparent",
          color: "#e2e8f0",
          width: "100%",
        }}
      />
    </div>
  );
}
</file>

<file path="src/components/Sidebar.css">
.sidebar {
  width: 240px;
  height: 100vh;
  padding: 1.5rem 1rem;
  background: var(--sidebar-bg, var(--card-bg));
  border-right: 1px solid var(--card-border);
  display: flex;
  flex-direction: column;
  position: fixed;
  left: 0;
  top: 0;
}

.sidebar-header {
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--card-border);
  margin-bottom: 1.25rem;
  text-align: center;
}

.sidebar-header h3 {
  color: var(--accent);
  font-weight: 700;
  letter-spacing: 0.5px;
}

/* ‚úÖ Navigation */
.sidebar-nav {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

/* ‚úÖ Clean nav item */
.sidebar-link {
  display: block;
  padding: 0.7rem 1rem;
  margin: 0.1rem 0;
  border-radius: 0.6rem;
  color: var(--text-color);
  text-decoration: none;
  font-weight: 500;
  transition: background 0.2s ease, color 0.2s ease;
}

/* ‚úÖ Hover */
.sidebar-link:hover {
  background: var(--hover-bg);
  color: var(--accent);
}

/* ‚úÖ Active item */
.sidebar-link.active {
  background: var(--accent-bg);
  color: var(--accent);
  font-weight: 600;
}

/* ‚úÖ Light/Dark Theme Variables */
:root {
  /* Light theme */
  --sidebar-bg: #f8f9fc;
  --card-bg: #ffffff;
  --card-border: #e5e7eb;
  --hover-bg: #f3f4f6;
  --accent: #f97316;
  --accent-bg: rgba(249, 115, 22, 0.15);
  --text-color: #111827;
}

[data-theme="dark"] {
  --sidebar-bg: #0f0f11;
  --card-bg: #1a1a1c;
  --card-border: #2c2c2f;
  --hover-bg: rgba(255, 255, 255, 0.06);
  --accent-bg: rgba(249, 115, 22, 0.18);
  --text-color: #e5e7eb;
}
</file>

<file path="src/components/Toolbar.jsx">
import React from "react";

export default function Toolbar({ children, right }) {
  return (
    <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", gap: "1rem", marginBottom: "0.75rem" }}>
      <div style={{ display: "flex", gap: "0.5rem", alignItems: "center" }}>{children}</div>
      {right && <div style={{ display: "flex", gap: "0.5rem" }}>{right}</div>}
    </div>
  );
}
</file>

<file path="src/context/AuthContext.jsx">
import React, { createContext, useState } from "react";
import api from "../services/api";

export const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(JSON.parse(localStorage.getItem("user")) || null);

  const login = async (username, password) => {
    const res = await api.post("/auth/login", { username, password });
    // üëá return the backend response to the Login component
    return res.data;
  };

  const verifyOTP = async (userId, otp) => {
    const res = await api.post("/auth/verify-otp", { userId, otp });
    const { token, user } = res.data;

    localStorage.setItem("token", token);
    localStorage.setItem("user", JSON.stringify(user));
    setUser(user);
    return user;
  };

  const logout = () => {
    localStorage.removeItem("token");
    localStorage.removeItem("user");
    setUser(null);
  };

  return (
    <AuthContext.Provider value={{ user, login, verifyOTP, logout }}>
      {children}
    </AuthContext.Provider>
  );
};
</file>

<file path="src/context/ThemeContext.jsx">
import React, { createContext, useContext, useEffect, useMemo, useState } from "react";

const ThemeModeContext = createContext({ mode: "dark", toggle: () => {} });

export function ThemeModeProvider({ children }) {
  const [mode, setMode] = useState(() => localStorage.getItem("ui-mode") || "dark");

  useEffect(() => {
    localStorage.setItem("ui-mode", mode);
    document.documentElement.setAttribute("data-theme", mode);
  }, [mode]);

  const value = useMemo(() => ({ mode, toggle: () => setMode((m) => (m === "dark" ? "light" : "dark")) }), [mode]);

  return <ThemeModeContext.Provider value={value}>{children}</ThemeModeContext.Provider>;
}

export function useThemeMode() {
  return useContext(ThemeModeContext);
}
</file>

<file path="src/pages/accounts/AccountsInvoices.jsx">
import React, { useEffect, useState } from "react";
import api from "../../services/api";
import Card from "../../components/Card";
import DataTable from "../../components/DataTable";

export default function AccountsInvoices() {
  const [invoices, setInvoices] = useState([]);

  useEffect(() => {
    (async () => {
      try {
        const res = await api.get("/accounts/invoices");
        setInvoices(res.data.invoices || []);
      } catch (err) {
        console.error("Failed to load invoices:", err);
      }
    })();
  }, []);

  return (
    <div style={{ padding: "2rem" }}>
      <h1>üßæ All Invoices</h1>
      <Card>
        <DataTable
          columns={[
            { key: "invoiceNumber", label: "Invoice #" },
            { key: "invoiceDate", label: "Date" },
            { key: "totalAmount", label: "Total (‚Çπ)" },
            { key: "paidAmount", label: "Paid (‚Çπ)" },
            { key: "status", label: "Status" },
          ]}
          rows={invoices.map((inv) => ({
            id: inv.id,
            invoiceNumber: inv.invoiceNumber,
            invoiceDate: new Date(inv.invoiceDate).toLocaleDateString(),
            totalAmount: inv.totalAmount,
            paidAmount: inv.paidAmount,
            status: inv.status,
          }))}
          emptyMessage="No invoices found"
        />
      </Card>
    </div>
  );
}
</file>

<file path="src/pages/accounts/AccountsNotes.jsx">
import React, { useEffect, useState } from "react";
import api from "../../services/api";
import Card from "../../components/Card";
import DataTable from "../../components/DataTable";

export default function AccountsNotes() {
  const [notes, setNotes] = useState([]);

  useEffect(() => {
    (async () => {
      try {
        const res = await api.get("/accounts/notes");
        setNotes(res.data.notes || []);
      } catch (err) {
        console.error("Failed to load credit/debit notes:", err);
      }
    })();
  }, []);

  return (
    <div style={{ padding: "2rem" }}>
      <h1>üíº Credit & Debit Notes</h1>
      <Card>
        <DataTable
          columns={[
            { key: "noteNumber", label: "Note #" },
            { key: "noteType", label: "Type" },
            { key: "noteDate", label: "Date" },
            { key: "amount", label: "Amount (‚Çπ)" },
            { key: "status", label: "Status" },
          ]}
          rows={notes.map((n) => ({
            id: n.id,
            noteNumber: n.noteNumber,
            noteType: n.noteType,
            noteDate: new Date(n.noteDate).toLocaleDateString(),
            amount: n.amount,
            status: n.status,
          }))}
          emptyMessage="No credit/debit notes available"
        />
      </Card>
    </div>
  );
}
</file>

<file path="src/pages/accounts/AccountsReports.jsx">
import React, { useEffect, useState } from "react";
import api from "../../services/api";
import Card from "../../components/Card";
import {
  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,
} from "recharts";

export default function AccountsReports() {
  const [report, setReport] = useState([]);

  useEffect(() => {
    (async () => {
      try {
        const res = await api.get("/accounts/dealer-reports");
        setReport(res.data.dealers || []);
      } catch (err) {
        console.error("Failed to load dealer reports:", err);
      }
    })();
  }, []);

  return (
    <div style={{ padding: "2rem" }}>
      <h1>üìä Dealer Financial Reports</h1>
      <Card>
        <ResponsiveContainer width="100%" height={350}>
          <BarChart data={report}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="dealer" />
            <YAxis />
            <Tooltip />
            <Bar dataKey="sales" fill="#3b82f6" name="Sales" />
            <Bar dataKey="paid" fill="#22c55e" name="Paid" />
          </BarChart>
        </ResponsiveContainer>
      </Card>
    </div>
  );
}
</file>

<file path="src/pages/dashboards/DashboardLayout.css">
/* ========== THEME-AWARE COMPACT DASHBOARD LAYOUT ========== */
.dashboard-container {
  padding: 1rem 1.25rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  transition: background 0.3s ease, color 0.3s ease;
}

.dashboard-header {
  margin-bottom: 0.5rem;
}

.dashboard-header h1 {
  font-size: 1.1rem;
  margin-bottom: 0.3rem;
  font-weight: 600;
}

.dashboard-header p {
  font-size: 0.85rem;
  color: var(--text-muted);
}

/* GRID STRUCTURE */
.dashboard-grid {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 1rem;
  width: 100%;
}

.dashboard-grid .column {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

/* CARD & COMPONENT STYLING */
.card {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: 14px;
  padding: 0.9rem 1rem;
  box-shadow: var(--card-shadow);
  transition: 0.25s ease;
}

.card:hover {
  border-color: var(--accent);
  transform: translateY(-1px);
}

.card h2,
.card h3 {
  font-size: 0.9rem;
  margin-bottom: 0.4rem;
  font-weight: 600;
}

.text-muted {
  color: var(--text-muted);
  font-size: 0.8rem;
}

/* STAT CARDS */
.stat-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 0.8rem;
}

.stat-card {
  text-align: center;
  border: 1px solid var(--card-border);
  background: var(--card-bg);
  border-radius: 10px;
  padding: 0.7rem;
}

.stat-card h3 {
  font-size: 0.8rem;
  color: var(--text-muted);
}

.stat-card p {
  font-size: 0.95rem;
  font-weight: 700;
  color: var(--accent);
}

/* TABLES */
.custom-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.8rem;
}

.custom-table th,
.custom-table td {
  padding: 0.35rem 0.5rem;
  border-bottom: 1px solid var(--card-border);
}

.custom-table th {
  text-transform: uppercase;
  color: var(--text-muted);
  font-size: 0.7rem;
}

/* BUTTON ROWS */
.quick-actions {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 0.7rem;
}

/* CHART */
.recharts-wrapper {
  font-size: 0.75rem;
}

/* COMPACT CARD HEIGHTS */
.chart-card {
  height: 230px;
}

/* THEME-INHERITED COLORS */
[data-theme="dark"] {
  --card-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

[data-theme="light"] {
  --card-shadow: 0 1px 8px rgba(0, 0, 0, 0.08);
}
</file>

<file path="src/services/socket.js">
// src/services/socket.js
import { io } from "socket.io-client";

const socket = io(import.meta.env.VITE_API_URL.replace("/api", ""), {
  transports: ["websocket"],
  auth: {
    token: localStorage.getItem("token"), // JWT from backend auth
  },
  reconnection: true,
});

export default socket;
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [
    react({
      babel: {
        plugins: [['babel-plugin-react-compiler']],
      },
    }),
  ],
})
</file>

<file path="src/components/DonutProgress.jsx">
import React from "react";
import { PieChart, Pie, Cell, ResponsiveContainer } from "recharts";

export default function DonutProgress({ value = 0, total = 100, colors = ["#f97316", "#1f2937"], center, label }) {
  const safeTotal = total <= 0 ? 1 : total;
  const percent = Math.max(0, Math.min(100, Math.round((value / safeTotal) * 100)));
  const data = [
    { name: "value", value: Math.max(0, value) },
    { name: "rest", value: Math.max(0, safeTotal - value) },
  ];
  return (
    <div style={{ display: "flex", alignItems: "center", gap: "1rem" }}>
      <div style={{ width: 120, height: 120 }}>
        <ResponsiveContainer width="100%" height="100%">
          <PieChart>
            <Pie
              data={data}
              innerRadius={48}
              outerRadius={58}
              paddingAngle={2}
              dataKey="value"
              startAngle={90}
              endAngle={-270}
            >
              {data.map((entry, index) => (
                <Cell key={`cell-${index}`} fill={colors[index] || colors[0]} />
              ))}
            </Pie>
          </PieChart>
        </ResponsiveContainer>
      </div>
      <div>
        {label && <div style={{ color: "#94a3b8" }}>{label}</div>}
        <div style={{ fontSize: "1.6rem", fontWeight: 700, color: "#e2e8f0" }}>{percent}%</div>
        {center}
      </div>
    </div>
  );
}
</file>

<file path="src/components/IconPillButton.jsx">
import React from "react";

export default function IconPillButton({ icon, label, onClick, tone = "primary" }) {
  const tones = {
    primary: "linear-gradient(90deg, #f97316, #ea580c)",
    success: "linear-gradient(90deg, #22c55e, #16a34a)",
    warning: "linear-gradient(90deg, #f59e0b, #d97706)",
    danger: "linear-gradient(90deg, #ef4444, #b91c1c)",
  };
  return (
    <button
      onClick={onClick}
      style={{
        border: "none",
        borderRadius: 9999,
        padding: "0.5rem 0.9rem",
        color: "#fff",
        display: "flex",
        alignItems: "center",
        gap: "0.5rem",
        background: tones[tone] || tones.primary,
        boxShadow: "0 0 12px rgba(0,0,0,0.25)",
        cursor: "pointer",
      }}
    >
      {icon && <span>{icon}</span>}
      <span style={{ fontWeight: 600 }}>{label}</span>
    </button>
  );
}
</file>

<file path="src/components/PageHeader.jsx">
import React from "react";

export default function PageHeader({ title, subtitle, actions }) {
  return (
    <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-end", gap: "1rem", marginBottom: "1.25rem" }}>
      <div>
        <h2 style={{ fontSize: "2rem", margin: 0, color: "#f97316" }}>{title}</h2>
        {subtitle && (
          <p style={{ marginTop: "0.25rem", color: "#94a3b8" }}>{subtitle}</p>
        )}
      </div>
      {actions && <div style={{ display: "flex", gap: "0.5rem" }}>{actions}</div>}
    </div>
  );
}
</file>

<file path="src/components/ProtectedRoute.jsx">
import React, { useContext } from 'react';
import { Navigate } from 'react-router-dom';
import { AuthContext } from '../context/AuthContext';

export default function ProtectedRoute({ children, roles = [] }) {
  const { user } = useContext(AuthContext);
  if (!user) return <Navigate to="/login" replace />;

  if (roles.length && !roles.includes(user.role)) {
    return <Navigate to="/unauthorized" replace />;
  }
  return children;
}
</file>

<file path="src/components/SparklineMini.jsx">
import React from "react";
import { AreaChart, Area, ResponsiveContainer } from "recharts";

export default function SparklineMini({ data, color = "#f97316" }) {
  return (
    <div style={{ width: "100%", height: 60 }}>
      <ResponsiveContainer width="100%" height="100%">
        <AreaChart data={data} margin={{ top: 6, right: 0, bottom: 0, left: 0 }}>
          <defs>
            <linearGradient id="spark" x1="0" y1="0" x2="0" y2="1">
              <stop offset="5%" stopColor={color} stopOpacity={0.7} />
              <stop offset="95%" stopColor={color} stopOpacity={0.05} />
            </linearGradient>
          </defs>
          <Area type="monotone" dataKey="v" stroke={color} fill="url(#spark)" strokeWidth={2} />
        </AreaChart>
      </ResponsiveContainer>
    </div>
  );
}
</file>

<file path="src/components/StatCard.jsx">
import React from "react";

export default function StatCard({ title, value, icon, accent = "#f97316" }) {
  return (
    <div
      className="card hover-glow"
      style={{ display: "flex", flexDirection: "column", gap: "0.25rem" }}
    >
      <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between" }}>
        <div style={{ display: "flex", alignItems: "center", gap: "0.5rem" }}>
          {icon && <span style={{ fontSize: "1.35rem" }}>{icon}</span>}
          <h4 style={{ margin: 0 }}>{title}</h4>
        </div>
        <div style={{ width: 8, height: 8, borderRadius: 9999, background: accent }} />
      </div>
      <div style={{ fontSize: "1.8rem", fontWeight: 700, color: accent }}>{value}</div>
    </div>
  );
}
</file>

<file path="src/pages/Admin.jsx">
import React, { useEffect, useState } from "react";
import api from "../services/api";

export default function Admin() {
  const [dealers, setDealers] = useState([]);

  const fetchDealers = async () => {
    const res = await api.get("/dealers");
    setDealers(res.data.dealers || res.data);
  };

  const toggleActive = async (id, active) => {
    await api.put(`/dealers/${id}`, { active: !active });
    fetchDealers();
  };

  useEffect(() => { fetchDealers(); }, []);

  return (
    <div>
      <h2>Dealer Management</h2>
      <table border="1" cellPadding="8">
        <thead><tr><th>ID</th><th>Name</th><th>Status</th><th>Action</th></tr></thead>
        <tbody>
          {dealers.map(d => (
            <tr key={d.id}>
              <td>{d.id}</td>
              <td>{d.name}</td>
              <td>{d.active ? "Active" : "Blocked"}</td>
              <td><button onClick={() => toggleActive(d.id, d.active)}>{d.active ? "Block" : "Unblock"}</button></td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
</file>

<file path="src/pages/Campaigns.jsx">
import React, { useEffect, useState } from "react";
import api from "../services/api";

export default function Campaigns() {
  const [campaigns, setCampaigns] = useState([]);
  const [newCampaign, setNewCampaign] = useState({ title: "", description: "", active: true });

  const fetchCampaigns = async () => {
    const res = await api.get("/campaigns");
    setCampaigns(res.data.campaigns || res.data);
  };

  useEffect(() => { fetchCampaigns(); }, []);

  const addCampaign = async (e) => {
    e.preventDefault();
    await api.post("/campaigns", newCampaign);
    setNewCampaign({ title: "", description: "", active: true });
    fetchCampaigns();
  };

  return (
    <div>
      <h2>Campaigns</h2>
      <form onSubmit={addCampaign}>
        <input placeholder="Title" value={newCampaign.title} onChange={e => setNewCampaign({...newCampaign, title: e.target.value})}/>
        <input placeholder="Description" value={newCampaign.description} onChange={e => setNewCampaign({...newCampaign, description: e.target.value})}/>
        <label>
          Active: 
          <input type="checkbox" checked={newCampaign.active} onChange={e => setNewCampaign({...newCampaign, active: e.target.checked})}/>
        </label>
        <button type="submit">Add</button>
      </form>

      <ul>
        {campaigns.map(c => (
          <li key={c.id}>{c.title} ‚Äî {c.active ? "Active" : "Inactive"}</li>
        ))}
      </ul>
    </div>
  );
}
</file>

<file path="src/components/PieChartCard.jsx">
import React from "react";
import { Card, CardContent, Typography } from "@mui/material";
import {
  PieChart,
  Pie,
  Cell,
  Tooltip,
  Legend,
  ResponsiveContainer,
} from "recharts";

export default function PieChartCard({ title, data = [] }) {
  const COLORS = ["#f97316", "#22c55e", "#a78bfa", "#ef4444", "#06b6d4"];

  // ‚úÖ Ensure data is always an array in the correct format
  const chartData = Array.isArray(data)
    ? data
    : Object.entries(data || {}).map(([name, value]) => ({
        name,
        value,
      }));

  // ‚úÖ Handle empty data gracefully
  if (!chartData.length) {
    return (
      <Card
        sx={{
          borderRadius: 3,
          boxShadow: 2,
          p: 2,
          backgroundColor: "rgba(255,255,255,0.04)",
          color: "#94a3b8",
          textAlign: "center",
        }}
      >
        <CardContent>
          <Typography variant="subtitle1">{title}</Typography>
          <Typography sx={{ mt: 2 }}>No data available</Typography>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card
      sx={{
        borderRadius: 3,
        boxShadow: 2,
        p: 2,
        backgroundColor: "rgba(255,255,255,0.04)",
        color: "#e2e8f0",
      }}
    >
      <CardContent>
        <Typography variant="subtitle1" sx={{ mb: 2 }}>
          {title}
        </Typography>

        <ResponsiveContainer width="100%" height={250}>
          <PieChart>
            <Pie
              data={chartData}
              dataKey="value"
              nameKey="name"
              cx="50%"
              cy="50%"
              outerRadius={80}
              label
            >
              {chartData.map((_, index) => (
                <Cell
                  key={`cell-${index}`}
                  fill={COLORS[index % COLORS.length]}
                />
              ))}
            </Pie>
            <Tooltip
              contentStyle={{
                backgroundColor: "rgba(12,12,14,0.9)",
                border: "1px solid rgba(255,255,255,0.08)",
                color: "#e2e8f0",
              }}
            />
            <Legend />
          </PieChart>
        </ResponsiveContainer>
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/main.jsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'
import { ThemeProvider, CssBaseline } from '@mui/material'
import getTheme from './theme.js'
import { ThemeModeProvider, useThemeMode } from './context/ThemeContext.jsx'

function ThemedApp() {
  const { mode } = useThemeMode();
  return (
    <ThemeProvider theme={getTheme(mode)}>
      <CssBaseline />
      <App />
    </ThemeProvider>
  )
}

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <ThemeModeProvider>
      <ThemedApp />
    </ThemeModeProvider>
  </StrictMode>,
)
</file>

<file path="src/pages/Dashboard.jsx">
import React, { useContext } from "react";
import { AuthContext } from "../context/AuthContext";
import DealerDashboard from "./dashboards/DealerDashboard";
import ManagerDashboard from "./dashboards/ManagerDashboard";
import AdminDashboard from "./dashboards/AdminDashboard";
import AccountsDashboard from "./dashboards/AccountsDashboard";
import InventoryDashboard from "./dashboards/InventoryDashboard";

export default function Dashboard() {
  const { user } = useContext(AuthContext);

  if (!user) return <p>Loading user...</p>;

  switch (user.role?.toLowerCase()) {
    case "dealer":
      return <DealerDashboard />;
    case "tm":
    case "am":
      return <ManagerDashboard />;
    case "admin":
      return <AdminDashboard />;
    case "accounts":
      return <AccountsDashboard />;
    case "inventory":
      return <InventoryDashboard />;
    default:
      return <p>No dashboard available for role: {user.role}</p>;
  }
}
</file>

<file path="src/pages/dashboards/ManagerDashboard.css">
/* ManagerDashboard.css - theme aware, uses CSS variables from index.css */

.manager-dashboard {
  min-height: 100%;
  padding: 1.25rem;
  font-family: "Inter", sans-serif;
  color: var(--text-color);
}

/* top-level grid: left main and right sidebar */
.dashboard-grid {
  display: grid;
  grid-template-columns: 70% 30%;
  gap: 1.25rem;
  margin-top: 1rem;
}

/* left column */
.left-col {
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
}

/* KPI row (compact cards) */
.kpi-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 0.75rem;
}

/* main chart card */
.main-chart-card {
  padding: 1rem;
}

/* right column (sidebar) */
.right-col {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

/* side compact KPIs */
.side-kpis {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.6rem;
}

.mini-kpi {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  padding: 0.7rem;
  border-radius: 12px;
  text-align: left;
  box-shadow: 0 6px 18px rgba(0,0,0,0.06);
}

.mini-kpi-title {
  font-size: 0.8rem;
  color: var(--text-muted);
  margin-bottom: 0.25rem;
}

.mini-kpi-value {
  font-weight: 700;
  font-size: 1.25rem;
  color: var(--text-color);
}

/* side cards */
.side-card {
  padding: 0.6rem;
}

/* campaign preview */
.campaign-preview {
  padding: 0.6rem 0;
  border-bottom: 1px solid var(--card-border);
  cursor: pointer;
}

/* message list */
.message-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.message-list li {
  padding: 0.5rem 0;
  border-bottom: 1px dashed var(--card-border);
}

/* small responsive tweaks */
@media (max-width: 1100px) {
  .dashboard-grid {
    grid-template-columns: 1fr;
  }
  .kpi-row {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 600px) {
  .kpi-row {
    grid-template-columns: 1fr;
  }
}
</file>

<file path="src/pages/Documents.jsx">
// Upgraded Documents.jsx with all enhancements
import React, { useEffect, useState } from "react";
import api from "../services/api";
import { FiUpload, FiDownload, FiTrash2, FiFileText, FiImage, FiFile, FiSearch } from "react-icons/fi";

export default function Documents() {
  const [files, setFiles] = useState([]);
  const [selectedFiles, setSelectedFiles] = useState([]);
  const [preview, setPreview] = useState(null);
  const [dragOver, setDragOver] = useState(false);
  const [progress, setProgress] = useState({});
  const [search, setSearch] = useState("");
  const [filter, setFilter] = useState("all");

  const fetchDocs = async () => {
    const res = await api.get("/documents");
    setFiles(res.data.documents || res.data);
  };

  useEffect(() => {
    fetchDocs();
  }, []);

  const handleFileSelection = (e) => {
    const list = Array.from(e.target.files);
    setSelectedFiles(list);
    setPreview(list.length === 1 ? URL.createObjectURL(list[0]) : null);
  };

  const handleDrop = (e) => {
    e.preventDefault();
    setDragOver(false);
    const dropped = Array.from(e.dataTransfer.files);
    setSelectedFiles(dropped);
    setPreview(dropped.length === 1 ? URL.createObjectURL(dropped[0]) : null);
  };

  const upload = async () => {
    if (!selectedFiles.length) return;

    const newProgress = {};
    const uploads = selectedFiles.map(async (file) => {
      const form = new FormData();
      form.append("file", file);
      form.append("documentType", "other");

      return api.post("/documents", form, {
        headers: { "Content-Type": "multipart/form-data" },
        onUploadProgress: (p) => {
          newProgress[file.name] = Math.round((p.loaded * 100) / p.total);
          setProgress({ ...newProgress });
        },
      });
    });

    await Promise.all(uploads);
    setSelectedFiles([]);
    setPreview(null);
    setProgress({});
    fetchDocs();
  };

  const download = async (id, name) => {
    const res = await api.get(`/documents/${id}/download`, { responseType: "blob" });
    const url = window.URL.createObjectURL(new Blob([res.data]));
    const a = document.createElement("a");
    a.href = url;
    a.download = name;
    a.click();
  };

  const remove = async (id) => {
    if (!window.confirm("Delete this document?")) return;
    await api.delete(`/documents/${id}`);
    fetchDocs();
  };

  const iconFor = (name) => {
    const ext = name.split(".").pop().toLowerCase();
    if (["jpg", "png", "jpeg", "gif"].includes(ext)) return <FiImage size={24} />;
    if (["pdf"].includes(ext)) return <FiFileText size={24} />;
    return <FiFile size={24} />;
  };

  const filtered = files.filter((f) => {
    const matchesSearch = f.documentName.toLowerCase().includes(search.toLowerCase());
    const matchesFilter = filter === "all" || f.documentType === filter;
    return matchesSearch && matchesFilter;
  });

  return (
    <div style={{ padding: "2rem", color: "var(--text-color)" }}>
      <h1 style={{ marginBottom: "1rem", fontSize: "1.8rem", fontWeight: 600 }}>Documents</h1>

      {/* Search + Filter */}
      <div style={{ display: "flex", gap: "1rem", marginBottom: "1.5rem" }}>
        <div style={{ position: "relative", flex: 1 }}>
          <FiSearch style={{ position: "absolute", top: 10, left: 10, opacity: 0.5 }} />
          <input
            placeholder="Search documents..."
            value={search}
            onChange={(e) => setSearch(e.target.value)}
            style={{ width: "100%", padding: "0.7rem 2.5rem", borderRadius: 10 }}
          />
        </div>

        <select
          value={filter}
          onChange={(e) => setFilter(e.target.value)}
          style={{ padding: "0.7rem", borderRadius: 10 }}
        >
          <option value="all">All</option>
          <option value="invoice">Invoices</option>
          <option value="document">Documents</option>
          <option value="other">Other</option>
        </select>
      </div>

      {/* Upload Zone */}
      <div
        onDragOver={(e) => {
          e.preventDefault();
          setDragOver(true);
        }}
        onDragLeave={() => setDragOver(false)}
        onDrop={handleDrop}
        style={{
          border: dragOver ? "2px dashed #f97316" : "2px dashed var(--card-border)",
          padding: "2rem",
          borderRadius: 15,
          textAlign: "center",
          marginBottom: "2rem",
        }}
      >
        <FiUpload size={40} style={{ opacity: 0.7 }} />
        <p>Drag & Drop files here or click to select</p>
        <input type="file" multiple style={{ display: "none" }} id="fileInput" onChange={handleFileSelection} />
        <button onClick={() => document.getElementById("fileInput").click()}>Choose Files</button>
      </div>

      {/* Preview + Upload */}
      {selectedFiles.length > 0 && (
        <div style={{ marginBottom: "2rem", padding: "1rem", borderRadius: 10, background: "var(--card-bg)" }}>
          <h3>Selected Files</h3>

          {preview && (
            <img src={preview} alt="preview" style={{ maxHeight: 120, marginBottom: "1rem", borderRadius: 8 }} />
          )}

          {selectedFiles.map((f) => (
            <div key={f.name} style={{ marginBottom: "0.5rem" }}>
              {f.name}
              {progress[f.name] && <div style={{ height: 6, background: "#333", borderRadius: 4 }}>
                <div style={{ width: `${progress[f.name]}%`, height: "100%", background: "#f97316", borderRadius: 4 }}></div>
              </div>}
            </div>
          ))}

          <button onClick={upload} style={{ marginTop: "1rem" }}>Upload All</button>
        </div>
      )}

      {/* File Grid */}
      <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fill, minmax(250px, 1fr))", gap: "1rem" }}>
        {filtered.map((f) => (
          <div key={f.id} style={{ padding: "1.2rem", borderRadius: 12, background: "var(--card-bg)", border: "1px solid var(--card-border)" }}>
            <div style={{ marginBottom: "1rem" }}>{iconFor(f.documentName)}</div>

            <h4 style={{ marginBottom: "0.5rem" }}>{f.documentName}</h4>
            <p style={{ opacity: 0.7, fontSize: "0.85rem" }}>{f.documentType}</p>

            <div style={{ marginTop: "1rem", display: "flex", gap: "0.5rem" }}>
              <button onClick={() => download(f.id, f.documentName)}><FiDownload /></button>
              <button onClick={() => remove(f.id)}><FiTrash2 /></button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}
</file>

<file path="src/pages/Invoices.jsx">
import React, { useEffect, useState } from "react";
import api from "../services/api";
import { Download, Search, FileText } from "lucide-react";

export default function Invoices() {
  const [invoices, setInvoices] = useState([]);
  const [search, setSearch] = useState("");

  useEffect(() => {
    (async () => {
      const res = await api.get("/invoices");
      setInvoices(res.data.invoices || res.data);
    })();
  }, []);

  const downloadPdf = async (id, invoiceNumber) => {
    try {
      const res = await api.get(`/invoices/${id}/pdf`, { responseType: "blob" });
      const url = window.URL.createObjectURL(new Blob([res.data]));
      const a = document.createElement("a");
      a.href = url;
      a.download = `invoice-${invoiceNumber}.pdf`;
      document.body.appendChild(a);
      a.click();
      a.remove();
    } catch (err) {
      console.error(err);
      alert("Failed to download PDF");
    }
  };

  const filtered = invoices.filter((i) => {
    const q = search.toLowerCase();
    return (
      i.invoiceNumber?.toString()?.includes(q) ||
      i.status?.toLowerCase()?.includes(q) ||
      i.totalAmount?.toString()?.includes(q)
    );
  });

  return (
    <div style={{ padding: "2rem" }}>
      {/* HEADER */}
      <div style={{ marginBottom: "1.5rem" }}>
        <h2 style={{ fontSize: "1.7rem", marginBottom: "0.5rem" }}>Invoices</h2>
        <p style={{ opacity: 0.7 }}>
          View, filter, and download your invoices.
        </p>
      </div>

      {/* SEARCH BAR */}
      <div
        style={{
          marginBottom: "1.5rem",
          display: "flex",
          alignItems: "center",
          gap: "0.5rem",
          background: "var(--card-bg)",
          border: "1px solid var(--card-border)",
          padding: "0.7rem 1rem",
          borderRadius: "12px",
        }}
      >
        <Search size={18} />
        <input
          type="text"
          placeholder="Search invoices..."
          value={search}
          onChange={(e) => setSearch(e.target.value)}
          style={{
            flex: 1,
            background: "transparent",
            border: "none",
            outline: "none",
            color: "var(--text-color)",
            fontSize: "1rem",
          }}
        />
      </div>

      {/* INVOICE TABLE */}
      <div
        style={{
          borderRadius: "14px",
          border: "1px solid var(--card-border)",
          background: "var(--card-bg)",
          overflow: "hidden",
          boxShadow: "0 4px 16px rgba(0,0,0,0.1)",
        }}
      >
        <table
          style={{
            width: "100%",
            borderCollapse: "collapse",
          }}
        >
          <thead
            style={{
              background: "rgba(255,255,255,0.05)",
              textAlign: "left",
            }}
          >
            <tr>
              {["Invoice #", "Date", "Amount", "Status", "Action"].map((head) => (
                <th
                  key={head}
                  style={{
                    padding: "1rem",
                    fontSize: "0.9rem",
                    fontWeight: 600,
                    borderBottom: "1px solid var(--card-border)",
                  }}
                >
                  {head}
                </th>
              ))}
            </tr>
          </thead>

          <tbody>
            {filtered.length === 0 && (
              <tr>
                <td
                  colSpan={5}
                  style={{
                    textAlign: "center",
                    padding: "2rem",
                    opacity: 0.6,
                  }}
                >
                  <FileText size={18} style={{ marginRight: 6 }} />
                  No invoices found
                </td>
              </tr>
            )}

            {filtered.map((i) => (
              <tr
                key={i.id}
                style={{
                  borderBottom: "1px solid var(--card-border)",
                  transition: "background 0.2s",
                }}
                onMouseEnter={(e) => (e.currentTarget.style.background = "rgba(255,255,255,0.04)")}
                onMouseLeave={(e) => (e.currentTarget.style.background = "transparent")}
              >
                <td style={{ padding: "1rem" }}>{i.invoiceNumber}</td>

                <td style={{ padding: "1rem" }}>
                  {new Date(i.invoiceDate).toLocaleDateString()}
                </td>

                <td style={{ padding: "1rem", fontWeight: 600 }}>
                  ‚Çπ{i.totalAmount}
                </td>

                <td style={{ padding: "1rem" }}>
                  <span
                    style={{
                      padding: "4px 10px",
                      borderRadius: "20px",
                      fontSize: "0.8rem",
                      fontWeight: 600,
                      color:
                        i.status === "Paid"
                          ? "#16a34a"
                          : i.status === "Pending"
                          ? "#f59e0b"
                          : "#ef4444",
                      background:
                        i.status === "Paid"
                          ? "rgba(22,163,74,0.15)"
                          : i.status === "Pending"
                          ? "rgba(245,158,11,0.15)"
                          : "rgba(239,68,68,0.15)",
                    }}
                  >
                    {i.status}
                  </span>
                </td>

                <td style={{ padding: "1rem" }}>
                  <button
                    onClick={() => downloadPdf(i.id, i.invoiceNumber)}
                    style={{
                      display: "flex",
                      alignItems: "center",
                      gap: "6px",
                      background:
                        "linear-gradient(90deg, var(--accent), var(--accent-dark))",
                      padding: "0.45rem 0.9rem",
                      color: "#fff",
                      borderRadius: "8px",
                      border: "none",
                      cursor: "pointer",
                      fontSize: "0.85rem",
                      fontWeight: 600,
                      boxShadow: "0 2px 6px rgba(0,0,0,0.2)",
                    }}
                  >
                    <Download size={16} />
                    PDF
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}
</file>

<file path="src/services/api.js">
import axios from "axios";

const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL || "http://localhost:3000/api",
  withCredentials: true,
});

api.interceptors.request.use((config) => {
  const token = localStorage.getItem("token");
  if (token) {
    config.headers.Authorization = `Bearer ${token}`; // ‚úÖ backend expects this format
  }
  return config;
});

api.interceptors.response.use(
  (res) => res,
  (err) => {
    if (err.response?.status === 401) {
      localStorage.removeItem("token");
      localStorage.removeItem("user");
      window.location.href = "/login";
    }
    return Promise.reject(err);
  }
);

export default api;
</file>

<file path="src/components/Navbar.jsx">
/*import React, { useContext, useState } from "react";
import { AuthContext } from "../context/AuthContext";
import { Link, useNavigate } from "react-router-dom";
import SearchInput from "./SearchInput";
import IconPillButton from "./IconPillButton";
import { useThemeMode } from "../context/ThemeContext";

export default function Navbar() {
  const { user, logout } = useContext(AuthContext);
  const navigate = useNavigate();
  const [globalSearch, setGlobalSearch] = useState("");
  const { mode, toggle } = useThemeMode();

  const handleLogout = () => {
    logout();
    navigate("/login");
  };

  return (
    <nav
      style={{
        display: "flex",
        justifyContent: "space-between",
        alignItems: "center",
        gap: "1rem",
        padding: "0.9rem 1.5rem",
        background: "rgba(12, 12, 14, 0.75)",
        backdropFilter: "blur(14px)",
        borderBottom: "1px solid rgba(255, 255, 255, 0.08)",
        boxShadow: "0 4px 24px rgba(0,0,0,0.45)",
        position: "sticky",
        top: 0,
        zIndex: 30,
      }}
    >
      <div style={{ display: "flex", alignItems: "center", gap: "0.6rem" }}>
        <img
          src="/logo192.png"
          alt="Portal Logo"
          style={{ width: "32px", height: "32px", borderRadius: "50%" }}
        />
        <strong style={{ fontSize: "1.15rem", color: "#f97316" }}>
          Dealer Portal
        </strong>
      </div>

      <div style={{ flex: 1, maxWidth: 680 }}>
        <SearchInput
          value={globalSearch}
          onChange={(e) => setGlobalSearch(e.target.value)}
          placeholder="Search across app..."
        />
      </div>

      <div style={{ display: "flex", alignItems: "center", gap: "0.75rem" }}>
        <IconPillButton
          icon={mode === "dark" ? "üåô" : "‚òÄÔ∏è"}
          label={mode === "dark" ? "Dark" : "Light"}
          tone="warning"
          onClick={toggle}
        />
        <IconPillButton
          icon="üßæ"
          label="New Invoice"
          tone="primary"
          onClick={() => navigate("/invoices")}
        />
        {user && (
          <span style={{ color: "#cbd5e1" }}>
            üëã Hi, <strong>{user.name || user.username}</strong>
          </span>
        )}
        <IconPillButton icon="üö™" label="Logout" tone="danger" onClick={handleLogout} />
      </div>
    </nav>
  );
}*/
import React, { useContext, useState } from "react";
import { AuthContext } from "../context/AuthContext";
import { useNavigate } from "react-router-dom";
import { useThemeMode } from "../context/ThemeContext";
import SearchInput from "./SearchInput";
import { IconButton, Tooltip, Avatar } from "@mui/material";
import { WbSunny, DarkMode, Notifications, AddCircleOutline } from "@mui/icons-material";

export default function Navbar() {
  const { user, logout } = useContext(AuthContext);
  const navigate = useNavigate();
  const { mode, toggle } = useThemeMode();
  const [globalSearch, setGlobalSearch] = useState("");

  const handleLogout = () => {
    logout();
    navigate("/login");
  };

  return (
    <nav
      style={{
        display: "flex",
        alignItems: "center",
        justifyContent: "space-between",
        padding: "0.75rem 1.5rem",
        backdropFilter: "blur(14px)",
        background:
          mode === "dark"
            ? "rgba(12,12,14,0.75)"
            : "rgba(255,255,255,0.8)",
        borderBottom:
          mode === "dark"
            ? "1px solid rgba(255,255,255,0.06)"
            : "1px solid rgba(0,0,0,0.08)",
        position: "sticky",
        top: 0,
        zIndex: 50,
        boxShadow: mode === "dark"
          ? "0 4px 24px rgba(0,0,0,0.4)"
          : "0 4px 20px rgba(0,0,0,0.1)",
      }}
    >
      {/* Search Bar */}
      <div style={{ flex: 1, maxWidth: 500 }}>
        <SearchInput
          placeholder="Search modules, dealers..."
          value={globalSearch}
          onChange={(e) => setGlobalSearch(e.target.value)}
        />
      </div>

      {/* Right-side Controls */}
      <div
        style={{
          display: "flex",
          alignItems: "center",
          gap: "1rem",
        }}
      >
        <Tooltip title="Create New">
          <IconButton
            sx={{
              color: "#f97316",
              transition: "0.3s",
              "&:hover": {
                transform: "scale(1.1)",
                color: "#fb923c",
              },
            }}
            onClick={() => navigate("/invoices")}
          >
            <AddCircleOutline />
          </IconButton>
        </Tooltip>

        <Tooltip title="Notifications">
          <IconButton
            sx={{
              color: mode === "dark" ? "#f8fafc" : "#1e293b",
              "&:hover": {
                color: "#f97316",
              },
            }}
          >
            <Notifications />
          </IconButton>
        </Tooltip>

        <Tooltip title="Toggle Theme">
          <IconButton
            onClick={toggle}
            sx={{
              color: mode === "dark" ? "#fbbf24" : "#0f172a",
              "&:hover": { color: "#f97316" },
            }}
          >
            {mode === "dark" ? <WbSunny /> : <DarkMode />}
          </IconButton>
        </Tooltip>

        {user && (
          <div style={{ display: "flex", alignItems: "center", gap: "0.6rem" }}>
            <Avatar
              sx={{
                width: 36,
                height: 36,
                bgcolor: "#f97316",
                fontWeight: 600,
              }}
            >
              {user.name ? user.name[0].toUpperCase() : "U"}
            </Avatar>
            <div style={{ fontSize: "0.9rem", color: "#cbd5e1" }}>
              <strong>{user.name || "User"}</strong>
            </div>
          </div>
        )}

        <Tooltip title="Logout">
          <IconButton
            onClick={handleLogout}
            sx={{
              color: "#ef4444",
              "&:hover": { transform: "scale(1.1)" },
            }}
          >
            üö™
          </IconButton>
        </Tooltip>
      </div>
    </nav>
  );
}
</file>

<file path="src/index.css">
/* ‚úÖ Global Theme Variables */
:root {
  /* Dark Mode (default) */
  --bg-base: linear-gradient(135deg, #0b0d10, #141216);
  --bg-glow: radial-gradient(circle at 20% 0%, rgba(249, 115, 22, 0.06), transparent 35%);

  --text-color: #e2e8f0;
  --text-muted: #94a3b8;

  --accent: #f97316;

  --sidebar-bg: rgba(30, 41, 59, 0.85);
  --sidebar-text: #cbd5e1;

  --navbar-bg: rgba(12, 12, 14, 0.75);

  --card-bg: rgba(255, 255, 255, 0.06);
  --card-border: rgba(255, 255, 255, 0.1);
}

/* ‚úÖ Light Mode Overrides */
[data-theme="light"] {
  --bg-base: linear-gradient(135deg, #f5f7fa, #e4e7eb);
  --bg-glow: radial-gradient(circle at 80% 0%, rgba(249, 115, 22, 0.12), transparent 40%);

  --text-color: #1f2937;
  --text-muted: #4b5563;

  --accent: #f97316;

  --sidebar-bg: rgba(255, 255, 255, 0.85);
  --sidebar-text: #1f2937;

  --navbar-bg: rgba(255, 255, 255, 0.65);

  --card-bg: rgba(255, 255, 255, 0.7);
  --card-border: rgba(0, 0, 0, 0.15);
}

/* ‚úÖ Body */
body {
  margin: 0;
  font-family: "Inter", "Segoe UI", sans-serif;
  background: var(--bg-glow), var(--bg-base);
  color: var(--text-color);
  min-height: 100vh;
  overflow-x: hidden;
}

/* ‚úÖ Navbar */
nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.9rem 1.5rem;
  background: var(--navbar-bg);
  backdrop-filter: blur(14px);
  border-bottom: 1px solid var(--card-border);
  color: var(--text-color);
  box-shadow: 0 4px 24px rgba(0,0,0,0.25);
}

/* ‚úÖ Sidebar */
aside {
  width: 240px;
  background: var(--sidebar-bg);
  color: var(--sidebar-text);
  backdrop-filter: blur(10px);
  padding: 2rem 1rem;
  border-right: 1px solid var(--card-border);
  height: 100vh;
  box-shadow: inset -2px 0 10px rgba(0,0,0,0.1);
}

aside a {
  display: flex;
  align-items: center;
  padding: 0.75rem 1rem;
  margin-bottom: 0.5rem;
  border-radius: 10px;
  color: inherit;
  text-decoration: none;
  transition: 0.3s;
  font-weight: 500;
}

aside a:hover {
  background: rgba(249, 115, 22, 0.15);
  color: var(--accent);
  transform: translateX(3px);
}

aside a.active {
  background: linear-gradient(90deg, #f97316, #ea580c);
  color: white !important;
  box-shadow: 0 0 15px rgba(249, 115, 22, 0.4);
}

/* ‚úÖ Cards */
.card {
  background: var(--card-bg);
  border-radius: 20px;
  padding: 1.5rem;
  border: 1px solid var(--card-border);
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  transition: 0.3s;
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 0 15px rgba(249, 115, 22, 0.4);
}

/* ‚úÖ Tables */
th,
td {
  padding: 12px;
  border-bottom: 1px solid var(--card-border);
  color: var(--text-color);
}

th {
  background: rgba(249, 115, 22, 0.1);
  color: var(--accent);
}

/* ‚úÖ Headings */
h2, h3, h4 {
  color: var(--accent);
  font-weight: 600;
}

/* ‚úÖ Utility */
.text-muted { color: var(--text-muted); }
</file>

<file path="src/pages/Login.jsx">
import React, { useState, useContext } from 'react';
import { AuthContext } from '../context/AuthContext';
import OTPVerify from './OTPVerify';

export default function Login() {
  const { login } = useContext(AuthContext);
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [userId, setUserId] = useState(null);
  const [otpSent, setOtpSent] = useState(false);
  const [error, setError] = useState(null);

  const submit = async (e) => {
    e.preventDefault();
    setError(null);
    try {
      const res = await login(username, password);
      if (res?.otpSent) {
        setUserId(res.userId);
        setOtpSent(true);
      }
    } catch (err) {
      setError(err.response?.data?.error || 'Login failed');
    }
  };

  if (otpSent) return <OTPVerify userId={userId} />;

  return (
    <div style={styles.page}>
      <div style={styles.overlay}>
        <div style={styles.card}>
          <h2 style={styles.title}>LOGIN</h2>
          {error && <p style={styles.error}>{error}</p>}
          <form onSubmit={submit}>
            <input
              style={styles.input}
              placeholder="Username"
              type="text"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
              required
            />
            <input
              style={styles.input}
              placeholder="Password"
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
            />
            <div style={styles.options}>
              
              
            </div>
            <button type="submit" style={styles.button}>Send OTP</button>
            
          </form>
        </div>
      </div>
    </div>
  );
}

const styles = {
  page: {
    height: '100vh',
    background: 'var(--bg-glow), var(--bg-base)',
    backgroundImage:
      'url("https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1920&q=80")',
    backgroundSize: 'cover',
    backgroundPosition: 'center',
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
    fontFamily: "'Poppins', sans-serif",
    color: '#f5f5f5',
  },
  overlay: {
    backdropFilter: 'blur(10px)',
    backgroundColor: 'rgba(0, 0, 0, 0.5)',
    width: '100%',
    height: '100%',
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
  },
  card: {
    width: 380,
    background: 'rgba(255,255,255,0.05)',
    boxShadow: '0 8px 40px rgba(0,0,0,0.6)',
    borderRadius: 16,
    padding: '2rem 2.5rem',
    textAlign: 'center',
    border: '1px solid rgba(255,255,255,0.1)',
  },
  title: {
    marginBottom: '1.5rem',
    letterSpacing: 1,
    fontWeight: 600,
    fontSize: '1.5rem',
  },
  input: {
    width: '100%',
    padding: '12px 14px',
    border: 'none',
    borderRadius: 8,
    outline: 'none',
    background: 'rgba(255,255,255,0.08)',
    color: '#fff',
    fontSize: 14,
    marginBottom: '1rem',
  },
  options: {
    display: 'flex',
    justifyContent: 'space-between',
    alignItems: 'center',
    fontSize: 13,
    marginBottom: '1.2rem',
    color: '#bbb',
  },
  checkbox: {
    display: 'flex',
    alignItems: 'center',
    gap: 6,
  },
  button: {
    width: '100%',
    padding: '12px',
    border: 'none',
    borderRadius: 8,
    background: 'linear-gradient(135deg, #1e3c72, #2a5298)',
    color: '#fff',
    cursor: 'pointer',
    fontWeight: 500,
    transition: 'all 0.3s ease',
  },
  link: {
    color: '#7eb2f2',
    textDecoration: 'none',
    cursor: 'pointer',
  },
  registerText: {
    fontSize: 13,
    marginTop: '1rem',
    color: '#aaa',
  },
  error: {
    color: '#ff7070',
    marginBottom: '1rem',
  },
};
</file>

<file path="src/pages/OTPVerify.jsx">
import React, { useState, useContext } from "react";
import { AuthContext } from "../context/AuthContext";
import { useNavigate } from "react-router-dom";

export default function OTPVerify({ userId }) {
  const { verifyOTP } = useContext(AuthContext);
  const [otp, setOtp] = useState("");
  const [error, setError] = useState(null);
  const navigate = useNavigate();

  const handleVerify = async (e) => {
    e.preventDefault();
    setError(null);
    try {
      await verifyOTP(userId, otp);
      navigate("/dashboard");
    } catch (err) {
      setError(err.response?.data?.error || "OTP verification failed");
    }
  };

  return (
    <div style={styles.page}>
      <div style={styles.overlay}>
        <div style={styles.card}>
          <h2 style={styles.title}>Verify OTP</h2>
          {error && <p style={styles.error}>{error}</p>}
          <form onSubmit={handleVerify}>
            <input
              style={styles.input}
              placeholder="Enter OTP"
              value={otp}
              onChange={(e) => setOtp(e.target.value)}
              required
            />
            <button type="submit" style={styles.button}>Verify</button>
          </form>
        </div>
      </div>
    </div>
  );
}

const styles = {
  page: {
    height: '100vh',
    background: 'var(--bg-glow), var(--bg-base)',
    backgroundImage:
      'url("https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1920&q=80")',
    backgroundSize: 'cover',
    backgroundPosition: 'center',
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
    fontFamily: "'Poppins', sans-serif",
    color: '#f5f5f5',
  },
  overlay: {
    backdropFilter: 'blur(10px)',
    backgroundColor: 'rgba(0, 0, 0, 0.5)',
    width: '100%',
    height: '100%',
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
  },
  card: {
    width: 360,
    background: 'rgba(255,255,255,0.05)',
    boxShadow: '0 8px 40px rgba(0,0,0,0.6)',
    borderRadius: 16,
    padding: '2rem 2.5rem',
    textAlign: 'center',
    border: '1px solid rgba(255,255,255,0.1)',
  },
  title: {
    marginBottom: '1.5rem',
    letterSpacing: 1,
    fontWeight: 600,
    fontSize: '1.5rem',
  },
  input: {
    width: '100%',
    padding: '12px 14px',
    border: 'none',
    borderRadius: 8,
    outline: 'none',
    background: 'rgba(255,255,255,0.08)',
    color: '#fff',
    fontSize: 14,
    marginBottom: '1rem',
  },
  button: {
    width: '100%',
    padding: '12px',
    border: 'none',
    borderRadius: 8,
    background: 'linear-gradient(135deg, #1e3c72, #2a5298)',
    color: '#fff',
    cursor: 'pointer',
    fontWeight: 500,
    transition: 'all 0.3s ease',
  },
  error: {
    color: '#ff7070',
    marginBottom: '1rem',
  },
};
</file>

<file path="src/theme.js">
import { createTheme } from "@mui/material/styles";

export default function getTheme(mode = "dark") {
  const isDark = mode === "dark";

  return createTheme({
    palette: {
      mode,
      primary: {
        main: "#f97316", // glowing amber accent
      },
      secondary: {
        main: "#a78bfa", // lavender accent
      },
      background: {
        default: isDark ? "#0b0d10" : "#f9fafb",
        paper: isDark
          ? "rgba(255,255,255,0.04)"
          : "rgba(255,255,255,0.9)",
      },
      text: {
        primary: isDark ? "#f8fafc" : "#1e293b",
        secondary: isDark ? "#94a3b8" : "#475569",
      },
      divider: isDark
        ? "rgba(255,255,255,0.08)"
        : "rgba(0,0,0,0.08)",
    },

    typography: {
      fontFamily: "'Inter', 'Poppins', sans-serif",
      allVariants: {
        transition: "color 0.3s ease",
      },
      h1: { fontWeight: 700 },
      h2: { fontWeight: 700 },
      h3: { fontWeight: 600 },
      h4: { fontWeight: 600 },
      h5: { fontWeight: 600 },
      h6: { fontWeight: 500 },
      body1: { lineHeight: 1.6 },
    },

    shape: { borderRadius: 20 },

    components: {
      // üåô Cards with glass effect
      MuiCard: {
        styleOverrides: {
          root: {
            borderRadius: 20,
            background: isDark
              ? "rgba(255,255,255,0.05)"
              : "rgba(255,255,255,0.8)",
            backdropFilter: "blur(12px)",
            border: isDark
              ? "1px solid rgba(255,255,255,0.08)"
              : "1px solid rgba(0,0,0,0.08)",
            boxShadow: isDark
              ? "0 10px 30px rgba(0,0,0,0.4), inset 0 0 10px rgba(255,255,255,0.03)"
              : "0 6px 20px rgba(0,0,0,0.15)",
            transition: "all 0.3s ease",
            "&:hover": {
              transform: "translateY(-4px)",
              boxShadow: isDark
                ? "0 16px 40px rgba(249,115,22,0.4)"
                : "0 12px 24px rgba(249,115,22,0.3)",
            },
          },
        },
      },

      // ‚ú® Buttons (rounded glowing gradients)
      MuiButton: {
        styleOverrides: {
          root: {
            borderRadius: 12,
            textTransform: "none",
            fontWeight: 600,
            paddingInline: 18,
            paddingBlock: 10,
            background:
              "linear-gradient(90deg, #f97316, #ea580c)",
            color: "#fff",
            boxShadow: "0 4px 20px rgba(249,115,22,0.3)",
            "&:hover": {
              boxShadow: "0 6px 25px rgba(249,115,22,0.4)",
              transform: "translateY(-2px)",
            },
          },
        },
      },

      // üìä Table cells (subtle borders + glow headers)
      MuiTableCell: {
        styleOverrides: {
          head: {
            fontWeight: 700,
            background: isDark
              ? "rgba(249,115,22,0.1)"
              : "rgba(249,115,22,0.15)",
            color: "#fbbf24",
          },
          root: {
            borderBottom: isDark
              ? "1px solid rgba(255,255,255,0.08)"
              : "1px solid rgba(0,0,0,0.08)",
          },
        },
      },

      // üß± Paper (glass backgrounds for menus/dialogs)
      MuiPaper: {
        styleOverrides: {
          root: {
            background: isDark
              ? "rgba(30,30,32,0.9)"
              : "rgba(255,255,255,0.85)",
            backdropFilter: "blur(10px)",
            borderRadius: 20,
            border: isDark
              ? "1px solid rgba(255,255,255,0.08)"
              : "1px solid rgba(0,0,0,0.08)",
          },
        },
      },

      // üß≠ AppBar / Navbar consistency
      MuiAppBar: {
        styleOverrides: {
          root: {
            background: isDark
              ? "rgba(26, 26, 31, 0.75)"
              : "rgba(255,255,255,0.8)",
            backdropFilter: "blur(14px)",
            color: isDark ? "#f8fafc" : "#1e293b",
            boxShadow: isDark
              ? "0 4px 24px rgba(0,0,0,0.5)"
              : "0 4px 24px rgba(0,0,0,0.1)",
          },
        },
      },

      // üîò Inputs / TextFields
      MuiOutlinedInput: {
        styleOverrides: {
          root: {
            borderRadius: 12,
            background: isDark
              ? "rgba(255,255,255,0.06)"
              : "rgba(0,0,0,0.03)",
            "& fieldset": {
              borderColor: isDark
                ? "rgba(255,255,255,0.1)"
                : "rgba(0,0,0,0.1)",
            },
            "&:hover fieldset": {
              borderColor: "#f97316",
            },
          },
          input: {
            color: isDark ? "#e2e8f0" : "#1e293b",
          },
        },
      },
    },
  });
}
</file>

<file path="src/App.jsx">
import React from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import { AuthProvider } from './context/AuthContext';
import Login from './pages/Login';
import Dashboard from './pages/Dashboard';
import Invoices from './pages/Invoices';
import Documents from './pages/Documents';
import Campaigns from "./pages/Campaigns";
import Reports from "./pages/Reports";
import Admin from "./pages/Admin";
import ProtectedRoute from './components/ProtectedRoute';
import Layout from './components/Layout';
import InventoryDashboard from "./pages/dashboards/InventoryDashboard";
import AccountsDashboard from "./pages/dashboards/AccountsDashboard";
import AccountsInvoices from "./pages/accounts/AccountsInvoices";
import AccountsNotes from "./pages/accounts/AccountsNotes";
import AccountsReports from "./pages/accounts/AccountsReports";


// ‚úÖ When Layout is inside ProtectedRoute, all child routes share Navbar & Sidebar
function App() {
  return (
    <AuthProvider>
      <BrowserRouter>
        <Routes>
          {/* Public route */}
          <Route path="/login" element={<Login />} />

          {/* Protected routes grouped inside Layout */}
          <Route
            path="/"
            element={
              <ProtectedRoute>
                <Layout />
              </ProtectedRoute>
            }
          >
            {/* All pages with the sidebar/navbar go here */}
            <Route index element={<Dashboard />} />
            <Route path="dashboard" element={<Dashboard />} />
            <Route path="invoices" element={<Invoices />} />
            <Route path="documents" element={<Documents />} />
            <Route path="campaigns" element={<Campaigns />} />
            <Route path="reports" element={<Reports />} />
            <Route path="admin" element={<Admin />} />
            <Route path="inventory" element={<InventoryDashboard />} />
            <Route path="accounts" element={<AccountsDashboard />} />
            <Route path="accounts/invoices" element={<AccountsInvoices />} />
<Route path="accounts/notes" element={<AccountsNotes />} />
<Route path="accounts/reports" element={<AccountsReports />} />


            {/* üîú Add Campaigns, Reports, Admin here */}
          </Route>
        </Routes>
      </BrowserRouter>
    </AuthProvider>
  );
}

export default App;
</file>

<file path="src/components/Layout.jsx">
import React from "react";
import Navbar from "./Navbar";
import Sidebar from "./Sidebar";
import { Outlet } from "react-router-dom";

export default function Layout() {
  return (
    <div
      style={{
        display: "flex",
        minHeight: "100vh",
        background: "var(--bg-glow), var(--bg-base)",
        color: "var(--text-color)",
      }}
    >
      {/* ‚úÖ Sidebar - now flexible height */}
      <Sidebar />

      {/* ‚úÖ Main section (Navbar + dashboard) */}
      <div
        style={{
          flex: 1,
          display: "flex",
          flexDirection: "column",
        }}
      >
        <Navbar />

        <main
          style={{
            flex: 1,
            padding: "2rem",
            overflowX: "hidden",
          }}
        >
          <div
            style={{
              background: "var(--card-bg)",
              borderRadius: "20px",
              border: "1px solid var(--card-border)",
              padding: "2rem",
              boxShadow: "0 4px 20px rgba(0,0,0,0.15)",
              backdropFilter: "blur(12px)",
              minHeight: "calc(100vh - 100px)", // subtracts navbar height
            }}
          >
            <Outlet />
          </div>
        </main>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/dashboards/AccountsDashboard.jsx">
import React, { useEffect, useState, useContext } from "react";
import api from "../../services/api";
import { AuthContext } from "../../context/AuthContext";
import PageHeader from "../../components/PageHeader";
import Toolbar from "../../components/Toolbar";
import SearchInput from "../../components/SearchInput";
import IconPillButton from "../../components/IconPillButton";
import DataTable from "../../components/DataTable";
import { toast } from "react-toastify";
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  Tooltip,
  ResponsiveContainer,
  Legend,
  PieChart,
  Pie,
  Cell,
} from "recharts";

export default function AccountsDashboard() {
  const { user } = useContext(AuthContext);
  const [summary, setSummary] = useState({});
  const [statements, setStatements] = useState([]);
  const [invoices, setInvoices] = useState([]);
  const [reconciliation, setReconciliation] = useState([]);
  const [search, setSearch] = useState("");
  const [loading, setLoading] = useState(true);

  // üé® Role color theme
  const roleTheme = {
    dealer: { color: "#3b82f6", bg: "#eff6ff" },
    manager: { color: "#f59e0b", bg: "#fff7ed" },
    accounts: { color: "#22c55e", bg: "#f0fdf4" },
    admin: { color: "#8b5cf6", bg: "#f5f3ff" },
  };
  const theme = roleTheme[user?.role] || { color: "#6b7280", bg: "#f9fafb" };
  const COLORS = ["#22c55e", "#3b82f6", "#f59e0b", "#ef4444", "#8b5cf6"];

  // üì° Fetch accounts data
  const fetchData = async () => {
    try {
      setLoading(true);
      const [summaryRes, stmtRes, invRes, recRes] = await Promise.all([
        api.get("/accounts/summary"),
        api.get("/accounts/statements"),
        api.get("/accounts/invoices"),
        api.get("/accounts/reconciliation"),
      ]);

      setSummary(summaryRes.data || {});
      setStatements(stmtRes.data?.statements || []);
      setInvoices(invRes.data?.invoices || []);
      setReconciliation(recRes.data?.pending || []);
    } catch (err) {
      toast.error("Failed to load accounts data");
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchData();
  }, []);

  // üîç Filter search
  const filtered = statements.filter((item) =>
    item.description?.toLowerCase().includes(search.toLowerCase())
  );

  // üìä Chart Data
  const barData =
    invoices.map((inv) => ({
      month: new Date(inv.invoiceDate).toLocaleString("default", { month: "short" }),
      total: inv.totalAmount,
      paid: inv.paidAmount,
    })) || [];

  const pieData = [
    { name: "Paid", value: invoices.reduce((s, i) => s + i.paidAmount, 0) },
    {
      name: "Outstanding",
      value: invoices.reduce((s, i) => s + (i.totalAmount - i.paidAmount), 0),
    },
  ];

  // üíæ Export as Excel or PDF
  const handleExport = async (format) => {
    try {
      const response = await api.get(`/accounts/export?format=${format}`, {
        responseType: "blob",
      });
      const url = window.URL.createObjectURL(new Blob([response.data]));
      const link = document.createElement("a");
      link.href = url;
      link.setAttribute(
        "download",
        `accounts_${new Date().toISOString().slice(0, 10)}.${format}`
      );
      document.body.appendChild(link);
      link.click();
    } catch (err) {
      toast.error("Export failed");
    }
  };

  // üß± Table Columns
  const columns = [
    { key: "date", label: "Date" },
    { key: "documentNumber", label: "Doc #" },
    { key: "debitAmount", label: "Debit" },
    { key: "creditAmount", label: "Credit" },
    { key: "balance", label: "Balance" },
  ];

  return (
    <div style={{ padding: "1rem", background: theme.bg, minHeight: "100vh" }}>
      <PageHeader
        title="Accounts Dashboard"
        subtitle={`Financial insights ‚Äî role: ${user?.role?.toUpperCase()}`}
        actions={[
          (user?.role !== "dealer") && (
            <IconPillButton
              key="pdf"
              label="Export PDF"
              icon="üìÑ"
              onClick={() => handleExport("pdf")}
            />
          ),
          (user?.role !== "dealer") && (
            <IconPillButton
              key="excel"
              label="Export Excel"
              icon="üìä"
              onClick={() => handleExport("xlsx")}
              tone="success"
            />
          ),
        ].filter(Boolean)}
      />

      <div
        style={{
          background: theme.color,
          color: "white",
          padding: "0.5rem 1rem",
          borderRadius: "10px",
          display: "inline-block",
          marginBottom: "1rem",
        }}
      >
        Logged in as <strong>{user?.role?.toUpperCase()}</strong>
      </div>

      <Toolbar>
        <SearchInput
          placeholder="Search by description or doc number..."
          value={search}
          onChange={(e) => setSearch(e.target.value)}
        />
      </Toolbar>

      {/* üîπ Summary Cards */}
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fit, minmax(180px, 1fr))",
          gap: "1rem",
          marginTop: "1.2rem",
        }}
      >
        <div className="card">
          üßæ <b>{summary.totalInvoices || 0}</b> Invoices
        </div>
        <div className="card">
          üìà ‚Çπ{summary.totalCredit || 0} Credit Notes
        </div>
        <div className="card">
          üìâ ‚Çπ{summary.totalDebit || 0} Debit Notes
        </div>
        <div className="card">
          üí∞ ‚Çπ{summary.totalOutstanding || 0} Outstanding
        </div>
      </div>

      {/* üìä Charts Row */}
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "2fr 1fr",
          gap: "1.5rem",
          marginTop: "2rem",
        }}
      >
        <div
          style={{
            background: "white",
            padding: "1rem",
            borderRadius: "12px",
            boxShadow: "0 2px 6px rgba(0,0,0,0.05)",
          }}
        >
          <h4 style={{ color: "#111827", marginBottom: "1rem" }}>
            üìÜ Monthly Invoice Trends
          </h4>
          <ResponsiveContainer width="100%" height={280}>
            <BarChart data={barData}>
              <XAxis dataKey="month" />
              <YAxis />
              <Tooltip />
              <Legend />
              <Bar dataKey="total" fill={theme.color} name="Total Invoices" />
              <Bar dataKey="paid" fill="#22c55e" name="Paid Amount" />
            </BarChart>
          </ResponsiveContainer>
        </div>

        <div
          style={{
            background: "white",
            padding: "1rem",
            borderRadius: "12px",
            boxShadow: "0 2px 6px rgba(0,0,0,0.05)",
          }}
        >
          <h4 style={{ color: "#111827", marginBottom: "1rem" }}>
            üíº Payment Distribution
          </h4>
          <ResponsiveContainer width="100%" height={280}>
            <PieChart>
              <Pie
                data={pieData}
                dataKey="value"
                nameKey="name"
                outerRadius={100}
                label
              >
                {pieData.map((_, i) => (
                  <Cell key={i} fill={COLORS[i % COLORS.length]} />
                ))}
              </Pie>
              <Tooltip />
              <Legend />
            </PieChart>
          </ResponsiveContainer>
        </div>
      </div>

      {/* üßæ Account Statements Table */}
      <div
        style={{
          background: "white",
          borderRadius: "12px",
          boxShadow: "0 2px 6px rgba(0,0,0,0.05)",
          marginTop: "2rem",
          padding: "1rem",
        }}
      >
        <h4 style={{ color: "#111827", marginBottom: "1rem" }}>
          üìã Recent Account Statements
        </h4>
        {loading ? (
          <p style={{ color: "#9ca3af" }}>Loading statements...</p>
        ) : (
          <DataTable columns={columns} rows={filtered.slice(0, 8)} />
        )}
      </div>

      {/* üî∏ Reconciliation Section */}
      <div
        style={{
          marginTop: "2rem",
          display: "flex",
          gap: "1rem",
          flexWrap: "wrap",
        }}
      >
        <div
          style={{
            background: reconciliation.length ? "#fee2e2" : "#dcfce7",
            padding: "1rem",
            borderRadius: "12px",
            flex: 1,
            minWidth: "220px",
          }}
        >
          <h4>üîÅ Reconciliation Status</h4>
          <p>
            {reconciliation.length
              ? `${reconciliation.length} invoice(s) pending reconciliation`
              : "All accounts are reconciled ‚úÖ"}
          </p>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/Reports.jsx">
// src/pages/Reports.jsx
import React, { useState, useEffect, useMemo } from "react";
import api from "../services/api";
import {
  Box,
  Grid,
  Card,
  CardContent,
  Typography,
  TextField,
  MenuItem,
  Button,
  CircularProgress,
  IconButton,
  Divider,
} from "@mui/material";
import { Download } from "@mui/icons-material";
import { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, PieChart, Pie, Cell, Legend } from "recharts";
import DashboardCard from "../components/DashboardCard";
import BarChartCard from "../components/BarChartCard";
import PieChartCard from "../components/PieChartCard";

// Small helper for dark look
const cardStyle = {
  background: "#0f1724",
  color: "#e6eef8",
  borderRadius: 12,
  boxShadow: "0 6px 18px rgba(2,6,23,0.6)",
};

const colors = ["#10b981", "#f97316", "#f59e0b", "#ef4444", "#a78bfa", "#06b6d4"];

const REPORT_OPTIONS = [
  { value: "", label: "Select Report Type" },
  { value: "dealer-performance", label: "Dealer Performance" },
  { value: "account-statement", label: "Account Statement" },
  { value: "invoice-register", label: "Invoice Register" },
  { value: "credit-debit-notes", label: "Credit / Debit Notes" },
  { value: "outstanding-receivables", label: "Outstanding Receivables" },
  { value: "territory", label: "Territory / Region" },
  { value: "admin-summary", label: "Admin Summary" },
  { value: "pending-approvals", label: "Pending Approvals" },
];

export default function Reports() {
  const [reportType, setReportType] = useState("");
  const [filters, setFilters] = useState({
    dealerId: "",
    productGroup: "",
    invoiceNumber: "",
    startDate: "",
    endDate: "",
    status: "",
    reasonCode: "",
    state: "",
    territory: "",
    region: "",
  });
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);
  const [exporting, setExporting] = useState(false);
  const [error, setError] = useState("");

  useEffect(() => {
    // clear data when report changes
    setData(null);
    setError("");
  }, [reportType]);

  const handleFilterChange = (e) => {
    const { name, value } = e.target;
    setFilters((prev) => ({ ...prev, [name]: value }));
  };

  const buildQuery = (extra = {}) => {
    const params = new URLSearchParams();
    Object.entries({ ...filters, ...extra }).forEach(([k, v]) => {
      if (v !== "" && v !== null && v !== undefined) params.append(k, v);
    });
    return params.toString();
  };

  const endpointForType = (type) => {
    // mapping kept consistent with backend routes
    return type;
  };

  const fetchReport = async () => {
    if (!reportType) {
      setError("Pick a report from the dropdown.");
      return;
    }
    setError("");
    setLoading(true);
    try {
      const endpoint = endpointForType(reportType);
      const q = buildQuery();
      const res = await api.get(`/reports/${endpoint}${q ? `?${q}` : ""}`);
      setData(res.data);
    } catch (err) {
      console.error("Error fetching report:", err);
      setError("Failed to fetch report. Check console.");
    } finally {
      setLoading(false);
    }
  };

  const exportReport = async (format = "pdf") => {
    if (!reportType) {
      setError("Select a report to export.");
      return;
    }
    setExporting(true);
    try {
      const endpoint = endpointForType(reportType);
      const q = buildQuery({ format });
      const res = await api.get(`/reports/${endpoint}${q ? `?${q}` : ""}`, {
        responseType: "blob",
      });
      const blob = new Blob([res.data], {
        type: format === "pdf" ? "application/pdf" : "application/vnd.ms-excel",
      });
      const url = window.URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.setAttribute("download", `${endpoint}.${format}`);
      document.body.appendChild(link);
      link.click();
      link.remove();
    } catch (err) {
      console.error("Export error:", err);
      setError("Export failed.");
    } finally {
      setExporting(false);
    }
  };

  const downloadInvoicePDF = async (invoiceId) => {
    try {
      const res = await api.get(`/invoices/${invoiceId}/pdf`, { responseType: "blob" });
      const blob = new Blob([res.data], { type: "application/pdf" });
      const url = window.URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.setAttribute("download", `invoice_${invoiceId}.pdf`);
      document.body.appendChild(link);
      link.click();
      link.remove();
    } catch (err) {
      console.error("Error downloading invoice PDF:", err);
      setError("Failed to download invoice copy");
    }
  };

  // Derived small visual helpers
  const dealerPerformanceChartData = useMemo(() => {
    if (!data) return [];
    // backend returns array of dealers or aggregated object depending on route - handle both
    if (Array.isArray(data)) {
      // array of dealer report objects
      return data.map((d) => ({
        name: d.dealerName || d.businessName || d.dealerName || "Unknown",
        total: parseFloat(d.totalSales || 0),
      }));
    }
    // if backend returns object with productGroups etc
    return (data.dealers || []).map((d) => ({
      name: d.dealerName || d.businessName || "Unknown",
      total: parseFloat(d.totalSales || 0),
    }));
  }, [data]);

  const outstandingPieData = useMemo(() => {
    if (!data) return [];
    const aging = data.aging || data;
    if (!aging) return [];
    if (Array.isArray(aging)) return [];
    return Object.entries(aging).map(([k, v]) => ({ name: k, value: parseFloat(v || 0) }));
  }, [data]);

  // Main renderer for each report
  const renderReportBody = () => {
    if (!reportType) {
      return (
        <Card sx={{ mt: 3, ...cardStyle }}>
          <CardContent>
            <Typography variant="h6" color="inherit">
              Pick a report to begin ‚Äî we‚Äôll fetch data from your backend.
            </Typography>
          </CardContent>
        </Card>
      );
    }

    if (loading) {
      return (
        <Box sx={{ display: "flex", justifyContent: "center", mt: 4 }}>
          <CircularProgress color="inherit" />
        </Box>
      );
    }

    if (error) {
      return (
        <Card sx={{ mt: 3, ...cardStyle }}>
          <CardContent>
            <Typography color="error">{error}</Typography>
          </CardContent>
        </Card>
      );
    }

    if (!data) {
      return null;
    }

    switch (reportType) {
      case "dealer-performance":
        return (
          <Box sx={{ mt: 3 }}>
            <Grid container spacing={2}>
              <Grid item xs={12} md={4}>
                <DashboardCard title="Total Dealers" value={data.length || data.dealers?.length || 0} />
              </Grid>
              <Grid item xs={12} md={4}>
                <DashboardCard title="Total Sales" value={`‚Çπ${(Array.isArray(data) ? data.reduce((s, d) => s + (d.totalSales || 0), 0) : data.totalSales) || 0}`} />
              </Grid>
              <Grid item xs={12} md={4}>
                <DashboardCard title="Pending Orders" value={`${data.pendingOrders || 0}`} />
              </Grid>

              <Grid item xs={12} md={8}>
                <Card sx={{ p: 1, ...cardStyle }}>
                  <CardContent>
                    <Typography variant="subtitle1" gutterBottom color="#9fb6d9">Dealer-wise Sales</Typography>
                    <div style={{ height: 320 }}>
                      <ResponsiveContainer width="100%" height="100%">
                        <BarChart data={dealerPerformanceChartData}>
                          <XAxis dataKey="name" tick={{ fill: "#cfe9ff" }} />
                          <YAxis tick={{ fill: "#cfe9ff" }} />
                          <Tooltip />
                          <Bar dataKey="total" fill="#f97316" radius={[6,6,0,0]} />
                        </BarChart>
                      </ResponsiveContainer>
                    </div>
                  </CardContent>
                </Card>
              </Grid>

              <Grid item xs={12} md={4}>
                <Card sx={{ p: 1, ...cardStyle }}>
                  <CardContent>
                    <Typography variant="subtitle1" color="#9fb6d9">Product Group Sales</Typography>
                    <div style={{ height: 220 }}>
                      <ResponsiveContainer width="100%" height="100%">
                        <PieChart>
                          <Pie
                            data={Object.entries((data[0]?.productGroups || data[0]?.productGroups) || (data.productGroups || {})).map(([k, v]) => ({ name: k, value: v }))}
                            dataKey="value"
                            nameKey="name"
                            innerRadius={40}
                            outerRadius={80}
                            label
                          >
                            {Object.entries((data[0]?.productGroups || data.productGroups || {})).map(([,], i) => (
                              <Cell key={`cell-${i}`} fill={colors[i % colors.length]} />
                            ))}
                          </Pie>
                          <Legend />
                        </PieChart>
                      </ResponsiveContainer>
                    </div>
                  </CardContent>
                </Card>
              </Grid>
            </Grid>
          </Box>
        );

      case "account-statement":
        return (
          <Box sx={{ mt: 3 }}>
            <Grid container spacing={2}>
              <Grid item xs={12} md={3}>
                <Card sx={{ ...cardStyle }}>
                  <CardContent>
                    <Typography variant="subtitle2" color="#9fb6d9">Opening Balance</Typography>
                    <Typography variant="h6">‚Çπ{data.openingBalance || 0}</Typography>
                  </CardContent>
                </Card>
              </Grid>
              <Grid item xs={12} md={3}>
                <Card sx={{ ...cardStyle }}>
                  <CardContent>
                    <Typography variant="subtitle2" color="#9fb6d9">Closing Balance</Typography>
                    <Typography variant="h6">‚Çπ{data.closingBalance || 0}</Typography>
                  </CardContent>
                </Card>
              </Grid>
              <Grid item xs={12} md={3}>
                <Card sx={{ ...cardStyle }}>
                  <CardContent>
                    <Typography variant="subtitle2" color="#9fb6d9">Total Debit</Typography>
                    <Typography variant="h6">‚Çπ{data.totalDebit || 0}</Typography>
                  </CardContent>
                </Card>
              </Grid>
              <Grid item xs={12} md={3}>
                <Card sx={{ ...cardStyle }}>
                  <CardContent>
                    <Typography variant="subtitle2" color="#9fb6d9">Total Credit</Typography>
                    <Typography variant="h6">‚Çπ{data.totalCredit || 0}</Typography>
                  </CardContent>
                </Card>
              </Grid>

              <Grid item xs={12}>
                <Card sx={{ mt: 2, ...cardStyle }}>
                  <CardContent>
                    <Typography variant="h6" color="#9fb6d9">Statements</Typography>
                    <Divider sx={{ my: 1, borderColor: "#1f2937" }} />
                    <div style={{ overflowX: "auto" }}>
                      <table style={{ width: "100%", color: "#e6eef8", borderCollapse: "collapse" }}>
                        <thead>
                          <tr style={{ background: "#071028" }}>
                            <th style={{ padding: 10 }}>Date</th>
                            <th>Description</th>
                            <th>Debit</th>
                            <th>Credit</th>
                            <th>Balance</th>
                          </tr>
                        </thead>
                        <tbody>
                          {(data.statements || []).map((s) => (
                            <tr key={s.id} style={{ borderBottom: "1px solid #1f2937" }}>
                              <td style={{ padding: 8 }}>{new Date(s.statementDate).toLocaleDateString()}</td>
                              <td>{s.description || s.documentType || "‚Äî"}</td>
                              <td>‚Çπ{s.debitAmount}</td>
                              <td>‚Çπ{s.creditAmount}</td>
                              <td>‚Çπ{s.balance}</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </CardContent>
                </Card>
              </Grid>
            </Grid>
          </Box>
        );

      case "invoice-register":
        return (
          <Box sx={{ mt: 3 }}>
            <Card sx={{ ...cardStyle }}>
              <CardContent>
                <Typography variant="h6" color="#9fb6d9">Invoice Register</Typography>
                <Divider sx={{ my: 1, borderColor: "#1f2937" }} />
                <div style={{ overflowX: "auto" }}>
                  <table style={{ width: "100%", color: "#e6eef8", borderCollapse: "collapse" }}>
                    <thead>
                      <tr style={{ background: "#071028" }}>
                        <th style={{ padding: 10 }}>Invoice #</th>
                        <th>Date</th>
                        <th>Dealer</th>
                        <th>Product Group</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      {(data.invoices || []).map((inv) => (
                        <tr key={inv.id} style={{ borderBottom: "1px solid #1f2937" }}>
                          <td style={{ padding: 8 }}>{inv.invoiceNumber}</td>
                          <td>{inv.invoiceDate ? new Date(inv.invoiceDate).toLocaleDateString() : "‚Äî"}</td>
                          <td>{inv.dealer?.businessName || "N/A"}</td>
                          <td>{inv.productGroup || "‚Äî"}</td>
                          <td>‚Çπ{inv.totalAmount}</td>
                          <td style={{ color: inv.status === "Paid" ? "#10b981" : "#f59e0b", fontWeight: 600 }}>{inv.status}</td>
                          <td>
                            <Button variant="outlined" size="small" sx={{ color: "#f97316", borderColor: "#f97316", textTransform: "none" }} onClick={() => downloadInvoicePDF(inv.id)}>Download PDF</Button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </CardContent>
            </Card>
          </Box>
        );

      case "credit-debit-notes":
        return (
          <Box sx={{ mt: 3 }}>
            <Card sx={{ ...cardStyle }}>
              <CardContent>
                <Typography variant="h6" color="#9fb6d9">Credit & Debit Notes</Typography>
                <Divider sx={{ my: 1, borderColor: "#1f2937" }} />
                <div style={{ overflowX: "auto" }}>
                  <table style={{ width: "100%", color: "#e6eef8", borderCollapse: "collapse" }}>
                    <thead>
                      <tr style={{ background: "#071028" }}>
                        <th style={{ padding: 10 }}>Note #</th>
                        <th>Date</th>
                        <th>Dealer</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Reason</th>
                      </tr>
                    </thead>
                    <tbody>
                      {(data.notes || []).map((n) => (
                        <tr key={n.id} style={{ borderBottom: "1px solid #1f2937" }}>
                          <td style={{ padding: 8 }}>{n.noteNumber}</td>
                          <td>{n.noteDate ? new Date(n.noteDate).toLocaleDateString() : "‚Äî"}</td>
                          <td>{n.dealer?.businessName || "N/A"}</td>
                          <td style={{ textTransform: "capitalize" }}>{n.noteType}</td>
                          <td>‚Çπ{n.amount}</td>
                          <td>{n.reasonCode || "-"}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>

                <Box sx={{ display: "flex", gap: 2, mt: 2 }}>
                  <Card sx={{ p: 1, flex: 1, ...cardStyle }}>
                    <CardContent>
                      <Typography variant="subtitle2" color="#9fb6d9">Total Credit</Typography>
                      <Typography variant="h6">‚Çπ{data.totalCredit || 0}</Typography>
                    </CardContent>
                  </Card>
                  <Card sx={{ p: 1, flex: 1, ...cardStyle }}>
                    <CardContent>
                      <Typography variant="subtitle2" color="#9fb6d9">Total Debit</Typography>
                      <Typography variant="h6">‚Çπ{data.totalDebit || 0}</Typography>
                    </CardContent>
                  </Card>
                </Box>
              </CardContent>
            </Card>
          </Box>
        );

      case "outstanding-receivables":
        return (
          <Box sx={{ mt: 3 }}>
            <Grid container spacing={2}>
              <Grid item xs={12} md={4}>
                <Card sx={{ ...cardStyle }}>
                  <CardContent>
                    <Typography variant="subtitle2" color="#9fb6d9">Total Outstanding</Typography>
                    <Typography variant="h5">‚Çπ{data.totalOutstanding || 0}</Typography>
                  </CardContent>
                </Card>
              </Grid>

              <Grid item xs={12} md={8}>
                <Card sx={{ ...cardStyle }}>
                  <CardContent>
                    <Typography variant="subtitle1" color="#9fb6d9">Aging</Typography>
                    <div style={{ height: 240 }}>
                      <ResponsiveContainer width="100%" height="100%">
                        <PieChart>
                          <Pie data={outstandingPieData} dataKey="value" nameKey="name" cx="50%" cy="50%" outerRadius={80} label>
                            {outstandingPieData.map((entry, idx) => (
                              <Cell key={`cell-${idx}`} fill={colors[idx % colors.length]} />
                            ))}
                          </Pie>
                          <Tooltip />
                          <Legend />
                        </PieChart>
                      </ResponsiveContainer>
                    </div>
                  </CardContent>
                </Card>
              </Grid>

              <Grid item xs={12}>
                <Card sx={{ ...cardStyle }}>
                  <CardContent>
                    <Typography variant="h6" color="#9fb6d9">Invoices</Typography>
                    <Divider sx={{ my: 1, borderColor: "#1f2937" }} />
                    <div style={{ overflowX: "auto" }}>
                      <table style={{ width: "100%", color: "#e6eef8", borderCollapse: "collapse" }}>
                        <thead>
                          <tr style={{ background: "#071028" }}>
                            <th style={{ padding: 10 }}>Invoice #</th>
                            <th>Dealer</th>
                            <th>Due Date</th>
                            <th>Balance</th>
                            <th>Days Past Due</th>
                          </tr>
                        </thead>
                        <tbody>
                          {(data.invoices || []).map((inv) => {
                            const daysPast = inv.dueDate ? Math.floor((new Date() - new Date(inv.dueDate)) / (1000 * 60 * 60 * 24)) : 0;
                            return (
                              <tr key={inv.id} style={{ borderBottom: "1px solid #1f2937" }}>
                                <td style={{ padding: 8 }}>{inv.invoiceNumber}</td>
                                <td>{inv.dealer?.businessName || "N/A"}</td>
                                <td>{inv.dueDate ? new Date(inv.dueDate).toLocaleDateString() : "‚Äî"}</td>
                                <td>‚Çπ{inv.balanceAmount}</td>
                                <td>{daysPast}</td>
                              </tr>
                            );
                          })}
                        </tbody>
                      </table>
                    </div>
                  </CardContent>
                </Card>
              </Grid>
            </Grid>
          </Box>
        );

      case "territory":
        return (
          <Box sx={{ mt: 3 }}>
            <Card sx={{ ...cardStyle }}>
              <CardContent>
                <Typography variant="h6" color="#9fb6d9">Territory / Region Report</Typography>
                <Divider sx={{ my: 1, borderColor: "#1f2937" }} />
                <div style={{ overflowX: "auto" }}>
                  <table style={{ width: "100%", color: "#e6eef8", borderCollapse: "collapse" }}>
                    <thead>
                      <tr style={{ background: "#071028" }}>
                        <th style={{ padding: 10 }}>Dealer Code</th>
                        <th>Business</th>
                        <th>State</th>
                        <th>Territory</th>
                        <th>Region</th>
                        <th>Total Sales</th>
                        <th>Outstanding</th>
                      </tr>
                    </thead>
                    <tbody>
                      {(data.report || []).map((r) => (
                        <tr key={r.dealerCode || r.businessName} style={{ borderBottom: "1px solid #1f2937" }}>
                          <td style={{ padding: 8 }}>{r.dealerCode}</td>
                          <td>{r.businessName}</td>
                          <td>{r.state}</td>
                          <td>{r.territory}</td>
                          <td>{r.region}</td>
                          <td>‚Çπ{r.totalSales}</td>
                          <td>‚Çπ{r.outstanding}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </CardContent>
            </Card>
          </Box>
        );

      case "admin-summary":
        return (
          <Box sx={{ mt: 3 }}>
            <Grid container spacing={2}>
              <Grid item xs={12} md={3}>
                <DashboardCard title="Active Campaigns" value={data.activeCampaigns || 0} />
              </Grid>
              <Grid item xs={12} md={3}>
                <DashboardCard title="Total Dealers" value={data.totalDealers || 0} />
              </Grid>
              <Grid item xs={12} md={3}>
                <DashboardCard title="Blocked Dealers" value={data.blockedDealers || 0} />
              </Grid>
              <Grid item xs={12} md={3}>
                <DashboardCard title="Pending Documents" value={data.pendingDocuments || 0} />
              </Grid>
              <Grid item xs={12} md={3} sx={{ mt: 2 }}>
                <DashboardCard title="Pending Pricing" value={data.pendingPricing || 0} />
              </Grid>
              <Grid item xs={12} md={3} sx={{ mt: 2 }}>
                <DashboardCard title="Total Invoices" value={data.totalInvoices || 0} />
              </Grid>
              <Grid item xs={12} md={3} sx={{ mt: 2 }}>
                <DashboardCard title="Total Outstanding" value={`‚Çπ${data.totalOutstanding || 0}`} />
              </Grid>
            </Grid>
          </Box>
        );

      case "pending-approvals":
        return (
          <Box sx={{ mt: 3 }}>
            <Card sx={{ ...cardStyle }}>
              <CardContent>
                <Typography variant="h6" color="#9fb6d9">Pending Approvals</Typography>
                <Divider sx={{ my: 1, borderColor: "#1f2937" }} />
                <div style={{ overflowX: "auto" }}>
                  <table style={{ width: "100%", color: "#e6eef8", borderCollapse: "collapse" }}>
                    <thead>
                      <tr style={{ background: "#071028" }}>
                        <th style={{ padding: 10 }}>ID</th>
                        <th>Dealer</th>
                        <th>Document Type</th>
                        <th>Created At</th>
                        <th>Status</th>
                      </tr>
                    </thead>
                    <tbody>
                      {(data || []).map((p) => (
                        <tr key={p.id} style={{ borderBottom: "1px solid #1f2937" }}>
                          <td style={{ padding: 8 }}>{p.id}</td>
                          <td>{p.dealerName}</td>
                          <td>{p.documentType}</td>
                          <td>{new Date(p.createdAt).toLocaleString()}</td>
                          <td>{p.status}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </CardContent>
            </Card>
          </Box>
        );

      default:
        return (
          <Card sx={{ mt: 3, ...cardStyle }}>
            <CardContent>
              <Typography>Report view not implemented yet.</Typography>
            </CardContent>
          </Card>
        );
    }
  };

  // UI filters area - keep compact and dynamic per report
  const renderFilters = () => {
    // show date range for most reports
    return (
      <Grid container spacing={1} alignItems="center" sx={{ mt: 2 }}>
        {/* Dealer Id */}
        <Grid item xs={12} sm={3} md={2}>
          <TextField
            name="dealerId"
            value={filters.dealerId}
            onChange={handleFilterChange}
            placeholder="Dealer ID"
            label="Dealer ID"
            size="small"
            variant="filled"
            sx={{ background: "#0b1220", borderRadius: 1, "& .MuiFilledInput-root": { color: "#e6eef8" } }}
            fullWidth
          />
        </Grid>

        <Grid item xs={12} sm={3} md={2}>
          <TextField
            name="productGroup"
            value={filters.productGroup}
            onChange={handleFilterChange}
            placeholder="Product Group"
            label="Product Group"
            size="small"
            variant="filled"
            sx={{ background: "#0b1220", borderRadius: 1, "& .MuiFilledInput-root": { color: "#e6eef8" } }}
            fullWidth
          />
        </Grid>

        <Grid item xs={12} sm={3} md={2}>
          <TextField
            name="invoiceNumber"
            value={filters.invoiceNumber}
            onChange={handleFilterChange}
            placeholder="Invoice #"
            label="Invoice #"
            size="small"
            variant="filled"
            sx={{ background: "#0b1220", borderRadius: 1, "& .MuiFilledInput-root": { color: "#e6eef8" } }}
            fullWidth
          />
        </Grid>

        <Grid item xs={12} sm={3} md={2}>
          <TextField
            type="date"
            name="startDate"
            label="From"
            value={filters.startDate}
            onChange={handleFilterChange}
            size="small"
            InputLabelProps={{ shrink: true }}
            variant="filled"
            sx={{ background: "#0b1220", borderRadius: 1, "& .MuiFilledInput-root": { color: "#e6eef8" } }}
            fullWidth
          />
        </Grid>

        <Grid item xs={12} sm={3} md={2}>
          <TextField
            type="date"
            name="endDate"
            label="To"
            value={filters.endDate}
            onChange={handleFilterChange}
            size="small"
            InputLabelProps={{ shrink: true }}
            variant="filled"
            sx={{ background: "#0b1220", borderRadius: 1, "& .MuiFilledInput-root": { color: "#e6eef8" } }}
            fullWidth
          />
        </Grid>

        <Grid item xs={12} sm={3} md={2}>
          <TextField
            select
            name="status"
            label="Status"
            value={filters.status}
            onChange={handleFilterChange}
            size="small"
            variant="filled"
            sx={{ background: "#0b1220", borderRadius: 1, "& .MuiFilledInput-root": { color: "#e6eef8" } }}
            fullWidth
          >
            <MenuItem value="">All</MenuItem>
            <MenuItem value="Paid">Paid</MenuItem>
            <MenuItem value="Unpaid">Unpaid</MenuItem>
            <MenuItem value="Pending">Pending</MenuItem>
            <MenuItem value="Delivered">Delivered</MenuItem>
          </TextField>
        </Grid>
      </Grid>
    );
  };

  return (
    <Box sx={{ p: 3 }}>
      <Box sx={{ display: "flex", alignItems: "center", justifyContent: "space-between" }}>
        <Box>
          <Typography variant="h5" sx={{ color: "#dbeafe", fontWeight: 700 }}>
            Reports Dashboard
          </Typography>
          <Typography variant="body2" sx={{ color: "#93c5fd" }}>
            Select a report, apply filters and generate beautiful manager-ready visuals.
          </Typography>
        </Box>

        <Box sx={{ display: "flex", gap: 1, alignItems: "center" }}>
          <TextField
            select
            value={reportType}
            onChange={(e) => setReportType(e.target.value)}
            size="small"
            sx={{
              minWidth: 220,
              background: "#0b1220",
              "& .MuiInputBase-input": { color: "#e6eef8" },
              borderRadius: 1,
            }}
          >
            {REPORT_OPTIONS.map((o) => (
              <MenuItem key={o.value} value={o.value}>
                {o.label}
              </MenuItem>
            ))}
          </TextField>

          <Button variant="contained" sx={{ bgcolor: "#f97316" }} onClick={fetchReport} disabled={loading}>
            {loading ? "Generating..." : "Generate"}
          </Button>

          <Button variant="outlined" sx={{ color: "#e6eef8", borderColor: "#f97316" }} onClick={() => exportReport("pdf")} startIcon={<Download />} disabled={exporting}>
            PDF
          </Button>
          <Button variant="outlined" sx={{ color: "#e6eef8", borderColor: "#f97316" }} onClick={() => exportReport("excel")} startIcon={<Download />} disabled={exporting}>
            Excel
          </Button>
        </Box>
      </Box>

      {/* Filters */}
      {renderFilters()}

      {/* Main Report Body */}
      {renderReportBody()}
    </Box>
  );
}
</file>

<file path="src/pages/dashboards/AdminDashboard.jsx">
import React, { useEffect, useState } from "react";
import api from "../../services/api";
import { useNavigate } from "react-router-dom";
import { toast } from "react-toastify";

import PageHeader from "../../components/PageHeader";
import StatCard from "../../components/StatCard";
import Card from "../../components/Card";
import Toolbar from "../../components/Toolbar";
import SearchInput from "../../components/SearchInput";
import IconPillButton from "../../components/IconPillButton";

import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
} from "recharts";

import "./DashboardLayout.css";

export default function AdminDashboard() {
  const navigate = useNavigate();
  const [summary, setSummary] = useState({});
  const [approvals, setApprovals] = useState([]);
  const [campaigns, setCampaigns] = useState([]);
  const [dealerActivity, setDealerActivity] = useState([]);
  const [loading, setLoading] = useState(true);
  const [search, setSearch] = useState("");

  useEffect(() => {
    const loadData = async () => {
      try {
        setLoading(true);
        const perf = await api.get("/reports/dealer-performance");
        const invoices = perf.data?.invoices || [];
        const totalSales = perf.data?.totalSales || 0;
        const dealers = new Set(invoices.map((i) => i.dealerId)).size;

        const campaignRes = await api.get("/campaigns");
        const activeCampaigns = campaignRes.data.campaigns?.length || 0;
        setCampaigns(campaignRes.data.campaigns || campaignRes.data);

        const docs = await api.get("/documents");
        const approvals = docs.data.documents || [];

        const monthly = {};
        invoices.forEach((i) => {
          const m = new Date(i.invoiceDate).toLocaleString("default", { month: "short" });
          monthly[m] = monthly[m] || { dealersOnboarded: 0, blockedDealers: 0 };
          monthly[m].dealersOnboarded += 1;
        });

        setDealerActivity(
          Object.keys(monthly).map((m) => ({
            month: m,
            dealersOnboarded: monthly[m].dealersOnboarded,
            blockedDealers: Math.floor(Math.random() * 3),
          }))
        );

        setSummary({
          dealers,
          totalSales,
          activeCampaigns,
          blockedDealers: 2,
          pendingApprovals: approvals.length,
        });
        setApprovals(approvals);
      } catch (e) {
        console.error("Admin dashboard fetch error:", e);
      } finally {
        setLoading(false);
      }
    };
    loadData();
  }, []);

  const handleApproval = async (id, action) => {
    toast.info(`Dealer ${action === "approve" ? "approved ‚úÖ" : "rejected ‚ùå"}`);
    setApprovals((prev) => prev.filter((a) => a.id !== id));
  };

  if (loading)
    return (
      <div className="center text-center" style={{ height: "80vh" }}>
        Loading Admin Dashboard...
      </div>
    );

  return (
    <div className="dashboard-container">
      {/* HEADER */}
      <PageHeader title="Admin Dashboard" subtitle="Quick overview of dealer performance & campaigns." />

      {/* TOOLBAR */}
      <Toolbar
        left={[
          <SearchInput
            key="search"
            value={search}
            onChange={(e) => setSearch(e.target.value)}
            placeholder="Search dealers or campaigns..."
          />,
        ]}
        right={[
          <IconPillButton
            key="new-camp"
            icon="‚ûï"
            label="Campaigns"
            onClick={() => navigate("/campaigns")}
          />,
          <IconPillButton
            key="manage"
            icon="üß©"
            tone="warning"
            label="Manage Dealers"
            onClick={() => navigate("/admin")}
          />,
        ]}
      />

      {/* KPI SUMMARY */}
      <div className="stat-grid">
        <StatCard title="Total Dealers" value={summary.dealers || 0} icon="üè™" />
        <StatCard title="Pending Approvals" value={summary.pendingApprovals || 0} icon="üïí" />
        <StatCard title="Blocked Dealers" value={summary.blockedDealers || 0} icon="üö´" />
        <StatCard title="Active Campaigns" value={summary.activeCampaigns || 0} icon="üì¢" />
      </div>

      {/* MAIN GRID */}
      <div className="dashboard-grid">
        {/* LEFT COLUMN */}
        <div className="column">
          <Card title="Dealer Activity (Last 6 Months)" className="chart-card">
            <ResponsiveContainer width="100%" height="100%">
              <BarChart data={dealerActivity}>
                <CartesianGrid strokeDasharray="3 3" stroke="var(--card-border)" />
                <XAxis dataKey="month" stroke="var(--text-muted)" />
                <YAxis stroke="var(--text-muted)" />
                <Tooltip
                  contentStyle={{
                    background: "var(--card-bg)",
                    border: "1px solid var(--card-border)",
                    color: "var(--text-color)",
                  }}
                />
                <Bar dataKey="dealersOnboarded" fill="var(--accent)" barSize={12} radius={[4, 4, 0, 0]} />
                <Bar dataKey="blockedDealers" fill="var(--text-muted)" barSize={12} radius={[4, 4, 0, 0]} />
              </BarChart>
            </ResponsiveContainer>
          </Card>

          <div className="stat-grid">
            <Card title="Market Demand" compact>
              <h2>{summary.activeCampaigns}</h2>
              <p className="text-muted small">Active campaigns</p>
            </Card>
            <Card title="New Dealers" compact>
              <h2>{summary.dealers}</h2>
              <p className="text-muted small">Recently onboarded</p>
            </Card>
          </div>
        </div>

        {/* RIGHT COLUMN */}
        <div className="column">
          <Card title="Pending Approvals">
            {approvals.slice(0, 4).length ? (
              approvals.slice(0, 4).map((a) => (
                <div
                  key={a.id}
                  className="approval-item"
                  style={{
                    display: "flex",
                    justifyContent: "space-between",
                    alignItems: "center",
                    borderBottom: "1px solid var(--card-border)",
                    padding: "0.5rem 0",
                  }}
                >
                  <div>
                    <strong>{a.dealerName}</strong>
                    <div className="text-muted small">{a.documentType}</div>
                  </div>
                  <div style={{ display: "flex", gap: "0.3rem" }}>
                    <button className="btn-success" onClick={() => handleApproval(a.id, "approve")}>
                      ‚úî
                    </button>
                    <button className="btn-danger" onClick={() => handleApproval(a.id, "reject")}>
                      ‚úñ
                    </button>
                  </div>
                </div>
              ))
            ) : (
              <p className="text-muted">No pending approvals</p>
            )}
          </Card>

          <Card title="Active Campaigns">
            {campaigns.slice(0, 4).length ? (
              campaigns.slice(0, 4).map((c) => (
                <div
                  key={c.id}
                  onClick={() => navigate(`/campaigns/${c.id}`)}
                  style={{
                    cursor: "pointer",
                    borderBottom: "1px solid var(--card-border)",
                    padding: "0.5rem 0",
                  }}
                >
                  <strong style={{ color: "var(--accent)" }}>{c.title}</strong>
                  <p className="text-muted small">{c.description}</p>
                </div>
              ))
            ) : (
              <p className="text-muted">No active campaigns</p>
            )}
          </Card>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/dashboards/ManagerDashboard.jsx">
// src/pages/dashboards/ManagerDashboard.jsx
import React, { useEffect, useState } from "react";
import api from "../../services/api";
import socket from "../../services/socket";
import { useNavigate } from "react-router-dom";

import PageHeader from "../../components/PageHeader";
import StatCard from "../../components/StatCard";
import Card from "../../components/Card";
import DataTable from "../../components/DataTable";
import Toolbar from "../../components/Toolbar";
import SearchInput from "../../components/SearchInput";
import IconPillButton from "../../components/IconPillButton";
import { toast } from "react-toastify";

import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  Legend,
  PieChart,
  Pie,
  Cell,
} from "recharts";

import "./ManagerDashboard.css";

export default function ManagerDashboard() {
  const navigate = useNavigate();
  const [summary, setSummary] = useState({});
  const [dealerPerformance, setDealerPerformance] = useState([]);
  const [pendingApprovals, setPendingApprovals] = useState([]);
  const [messages, setMessages] = useState([]);
  const [campaigns, setCampaigns] = useState([]);
  const [inventory, setInventory] = useState([]);
  const [loading, setLoading] = useState(true);
  const [search, setSearch] = useState("");

  const COLORS = ["#3b82f6", "#60a5fa", "#2563eb", "#1d4ed8", "#93c5fd"];
  const accent = "#3b82f6";

  useEffect(() => {
    const loadData = async () => {
      try {
        setLoading(true);
        const [summaryRes, perfRes, approvalsRes, msgRes, campRes, invRes] =
          await Promise.all([
            api.get("/reports/dealer-performance"),
            api.get("/reports/territory"),
            api.get("/reports/pending-approvals"),
            api.get("/messages"),
            api.get("/campaigns"),
            api.get("/inventory/summary"),
          ]);

        setSummary(summaryRes.data || {});
        setDealerPerformance(perfRes.data.report || []);
        setPendingApprovals(approvalsRes.data || []);
        setMessages(msgRes.data.messages || msgRes.data || []);
        setCampaigns(campRes.data.campaigns || campRes.data || []);
        setInventory(invRes.data.inventory || []);
      } catch (err) {
        console.error("Manager dashboard load error:", err);
        toast.error("Failed to load dashboard data");
      } finally {
        setLoading(false);
      }
    };
    loadData();
  }, []);

  // ‚úÖ Realtime updates
  useEffect(() => {
    const token = localStorage.getItem("token");
    if (token) socket.auth = { token };
    socket.connect();

    socket.on("document:new", (data) => {
      toast.info(`üìÑ New document uploaded by Dealer ${data.dealerId}`);
      setPendingApprovals((prev) => [
        {
          id: data.id || Date.now(),
          dealerName: data.dealerName || `Dealer ${data.dealerId}`,
          documentType: data.documentType || "Upload",
          createdAt: new Date(),
        },
        ...prev,
      ]);
    });

    socket.on("message:new", (msg) => {
      toast.success(`üí¨ Message from Dealer: ${msg.content}`);
      setMessages((prev) => [msg, ...prev]);
    });

    socket.on("campaign:new", (campaign) => {
      toast.info(`üì¢ New Campaign: ${campaign.title}`);
      setCampaigns((prev) => [campaign, ...prev]);
    });

    return () => socket.disconnect();
  }, []);

  if (loading)
    return (
      <div className="loading-screen">
        <div className="loading-text">Loading Manager Dashboard...</div>
      </div>
    );

  // üîç Stock health classification
  const lowStock = inventory.filter((i) => i.available < 20);
  const mediumStock = inventory.filter(
    (i) => i.available >= 20 && i.available < 100
  );
  const highStock = inventory.filter((i) => i.available >= 100);

  return (
    <div className="manager-dashboard" style={{ color: "var(--text-color)" }}>
      <PageHeader
        title="Regional Manager Dashboard"
        subtitle="Monitor dealers, campaigns, and inventory performance in real-time."
      />

      <Toolbar
        left={[
          <SearchInput
            key="search"
            value={search}
            onChange={(e) => setSearch(e.target.value)}
            placeholder="Search dealers, campaigns..."
          />,
        ]}
        right={[
          <IconPillButton
            key="reports"
            icon="üìä"
            label="Reports"
            onClick={() => navigate("/reports")}
          />,
          <IconPillButton
            key="campaigns"
            icon="üì¢"
            label="Campaigns"
            tone="warning"
            onClick={() => navigate("/campaigns")}
          />,
        ]}
      />

      <div className="dashboard-grid">
        {/* LEFT COLUMN */}
        <div className="left-col">
          <div className="kpi-row">
            <StatCard
              title="Total Dealers"
              value={summary.totalDealers || 0}
              icon="üè™"
            />
            <StatCard
              title="Active Campaigns"
              value={campaigns.length}
              icon="üì¢"
            />
            <StatCard
              title="Pending Approvals"
              value={pendingApprovals.length}
              icon="üïí"
            />
            <StatCard title="New Messages" value={messages.length} icon="üí¨" />
          </div>

          {/* üîî Critical Low Stock Alert */}
          {lowStock.length > 0 && (
            <div
              className="alert-banner"
              style={{
                background: "#fee2e2",
                color: "#b91c1c",
                padding: "0.75rem",
                borderRadius: "8px",
                marginBottom: "1rem",
                textAlign: "center",
                fontWeight: 500,
              }}
            >
              ‚ö†Ô∏è {lowStock.length} products are critically low on stock!
            </div>
          )}

          {/* üìä Stock Health Summary */}
          <Card title="Stock Health Overview" style={{ marginBottom: "1rem" }}>
            {inventory.length ? (
              <div
                style={{
                  display: "flex",
                  justifyContent: "space-around",
                  textAlign: "center",
                }}
              >
                <div>
                  <h3 style={{ color: "#ef4444" }}>{lowStock.length}</h3>
                  <p className="text-muted">Low Stock</p>
                </div>
                <div>
                  <h3 style={{ color: "#facc15" }}>{mediumStock.length}</h3>
                  <p className="text-muted">Moderate</p>
                </div>
                <div>
                  <h3 style={{ color: "#10b981" }}>{highStock.length}</h3>
                  <p className="text-muted">Healthy</p>
                </div>
              </div>
            ) : (
              <p className="text-muted">No inventory data available</p>
            )}
          </Card>

          {/* üìà Dealer Performance Chart */}
          <Card
            title="Top 5 Dealers by Sales"
            className="main-chart-card"
            style={{ marginBottom: "1rem" }}
          >
            <ResponsiveContainer width="100%" height={340}>
              <BarChart
                data={dealerPerformance.slice(0, 5)}
                margin={{ top: 10, right: 20, left: 0, bottom: 20 }}
              >
                <CartesianGrid strokeDasharray="3 3" stroke="#e5e7eb" />
                <XAxis dataKey="businessName" stroke="#6b7280" />
                <YAxis stroke="#6b7280" />
                <Tooltip />
                <Legend />
                <Bar dataKey="totalSales" fill={accent} radius={[8, 8, 0, 0]} />
              </BarChart>
            </ResponsiveContainer>
          </Card>

          {/* ü•ß Inventory Overview */}
          <Card title="Inventory Overview (Top 5 Products)">
            {inventory.length > 0 ? (
              <ResponsiveContainer width="100%" height={300}>
                <PieChart>
                  <Pie
                    data={inventory.slice(0, 5)}
                    dataKey="available"
                    nameKey="product"
                    outerRadius={100}
                    fill={accent}
                    label
                  >
                    {inventory.map((_, i) => (
                      <Cell key={i} fill={COLORS[i % COLORS.length]} />
                    ))}
                  </Pie>
                  <Tooltip />
                </PieChart>
              </ResponsiveContainer>
            ) : (
              <p className="text-muted">No inventory data available</p>
            )}
          </Card>

          {/* üßæ Pending Approvals Table */}
          <Card title="Pending Approvals" style={{ marginTop: "1rem" }}>
            <DataTable
              columns={[
                { key: "dealer", label: "Dealer" },
                { key: "document", label: "Document" },
                { key: "date", label: "Date" },
                { key: "status", label: "Status" },
              ]}
              rows={pendingApprovals
                .filter((a) => {
                  const q = search.toLowerCase();
                  return (
                    !q ||
                    (a.dealerName || "").toLowerCase().includes(q) ||
                    String(a.dealerId || "").includes(q)
                  );
                })
                .slice(0, 8)
                .map((a) => ({
                  id: a.id || Math.random(),
                  dealer: a.dealerName || a.dealerId,
                  document: a.documentType || "Document",
                  date: new Date(a.createdAt).toLocaleDateString(),
                  status: "Pending",
                }))}
              emptyMessage="No pending approvals"
            />
          </Card>
        </div>

        {/* RIGHT COLUMN */}
        <aside className="right-col">
          <div className="side-kpis">
            <div className="mini-kpi">
              <div className="mini-kpi-title">Total Sales</div>
              <div className="mini-kpi-value">
                ‚Çπ {summary.totalSales || 0}
              </div>
            </div>

            <div className="mini-kpi">
              <div className="mini-kpi-title">Active Dealers</div>
              <div className="mini-kpi-value">
                {summary.activeDealers || summary.totalDealers || 0}
              </div>
            </div>

            <div className="mini-kpi">
              <div className="mini-kpi-title">Pending</div>
              <div className="mini-kpi-value">{pendingApprovals.length}</div>
            </div>

            <div className="mini-kpi">
              <div className="mini-kpi-title">Campaigns</div>
              <div className="mini-kpi-value">{campaigns.length}</div>
            </div>
          </div>

          {/* üí¨ Recent Messages */}
          <Card
            title="Recent Messages"
            className="side-card"
            style={{ marginTop: "1rem" }}
          >
            <div style={{ maxHeight: 220, overflowY: "auto" }}>
              {messages.length > 0 ? (
                <ul className="message-list">
                  {messages.slice(0, 6).map((msg) => (
                    <li key={msg.id}>
                      <div style={{ fontWeight: 600 }}>
                        {msg.dealerName || `Dealer ${msg.senderId}`}
                      </div>
                      <div className="text-muted" style={{ fontSize: 13 }}>
                        {msg.content}
                      </div>
                    </li>
                  ))}
                </ul>
              ) : (
                <p className="text-muted">No new messages</p>
              )}
            </div>
          </Card>

          {/* üì¢ Active Campaigns */}
          <Card
            title="Active Campaigns"
            className="side-card"
            style={{ marginTop: "1rem" }}
          >
            <div style={{ maxHeight: 220, overflowY: "auto" }}>
              {campaigns.length > 0 ? (
                campaigns.slice(0, 6).map((c) => (
                  <div
                    key={c.id}
                    className="campaign-preview"
                    onClick={() => navigate(`/campaigns/${c.id}`)}
                  >
                    <div style={{ fontWeight: 700, color: accent }}>
                      {c.title}
                    </div>
                    <div className="text-muted" style={{ fontSize: 13 }}>
                      {c.description}
                    </div>
                  </div>
                ))
              ) : (
                <p className="text-muted">No campaigns running</p>
              )}
            </div>
          </Card>
        </aside>
      </div>
    </div>
  );
}
</file>

<file path="package.json">
{
  "name": "dealer-portal-react",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@emotion/react": "^11.14.0",
    "@emotion/styled": "^11.14.1",
    "@mui/icons-material": "^7.3.5",
    "@mui/material": "^7.3.4",
    "axios": "^1.13.1",
    "framer-motion": "^12.23.24",
    "lucide-react": "^0.552.0",
    "react": "^19.1.1",
    "react-countup": "^6.5.3",
    "react-dom": "^19.1.1",
    "react-hook-form": "^7.65.0",
    "react-icons": "^5.5.0",
    "react-router-dom": "^7.9.5",
    "react-toastify": "^11.0.5",
    "recharts": "^3.3.0",
    "socket.io-client": "^4.8.1"
  },
  "devDependencies": {
    "@eslint/js": "^9.36.0",
    "@types/react": "^19.1.16",
    "@types/react-dom": "^19.1.9",
    "@vitejs/plugin-react": "^5.0.4",
    "autoprefixer": "^10.4.21",
    "babel-plugin-react-compiler": "^19.1.0-rc.3",
    "eslint": "^9.36.0",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.22",
    "globals": "^16.4.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^4.1.16",
    "vite": "^7.1.7"
  }
}
</file>

<file path="src/components/Sidebar.jsx">
import React, { useContext, useState } from "react";
import { AuthContext } from "../context/AuthContext";
import { Link, useLocation } from "react-router-dom";
import {
  FaHome,
  FaFileInvoice,
  FaFileAlt,
  FaChartBar,
  FaCogs,
  FaUsers,
  FaWarehouse,
  FaBars,
} from "react-icons/fa";

export default function Sidebar() {
  const { user } = useContext(AuthContext);
  const { pathname } = useLocation();

  const [collapsed, setCollapsed] = useState(false);

  const role = user?.role?.toLowerCase() || "user";

  const baseLinks = [{ path: "/dashboard", label: "Dashboard", icon: <FaHome /> }];

  const roleLinks = {
    dealer: [
      { path: "/invoices", label: "Invoices", icon: <FaFileInvoice /> },
      { path: "/documents", label: "Documents", icon: <FaFileAlt /> },
    ],
    tm: [{ path: "/reports", label: "Reports", icon: <FaChartBar /> }],
    am: [{ path: "/reports", label: "Reports", icon: <FaChartBar /> }],
    admin: [
      { path: "/campaigns", label: "Campaigns", icon: <FaCogs /> },
      { path: "/admin", label: "Dealer Mgmt", icon: <FaUsers /> },
      { path: "/reports", label: "Reports", icon: <FaChartBar /> },
    ],
    accounts: [{ path: "/reports", label: "Accounts Reports", icon: <FaChartBar /> }],
    inventory: [{ path: "/inventory", label: "Stock View", icon: <FaWarehouse /> }],
  };

  const links = [...baseLinks, ...(roleLinks[role] || [])];

  return (
    <aside
      style={{
        width: collapsed ? "70px" : "240px",
        background: "var(--sidebar-bg)",
        backdropFilter: "blur(14px)",
        borderRight: "1px solid var(--card-border)",
        padding: "1rem",
        display: "flex",
        flexDirection: "column",
        transition: "width 0.3s ease",
        overflowY: "auto",
        overflowX: "hidden",
      }}
    >
      {/* HEADER + TOGGLE */}
      <div
        style={{
          display: "flex",
          justifyContent: collapsed ? "center" : "space-between",
          alignItems: "center",
          marginBottom: "2rem",
          paddingBottom: "1rem",
          borderBottom: "1px solid var(--card-border)",
        }}
      >
        {!collapsed && (
          <h3 style={{ color: "#f97316", fontWeight: "700" }}>
            {role.toUpperCase()}
          </h3>
        )}

        <button
          onClick={() => setCollapsed(!collapsed)}
          style={{
            background: "var(--card-bg)",
            border: "1px solid var(--card-border)",
            borderRadius: "8px",
            padding: "0.5rem",
            cursor: "pointer",
            color: "var(--text-color)",
          }}
        >
          <FaBars />
        </button>
      </div>

      {/* NAV LINKS */}
      <div style={{ display: "flex", flexDirection: "column", gap: "0.5rem" }}>
        {links.map((l) => {
          const active = pathname === l.path;

          return (
            <div style={{ position: "relative" }} key={l.path}>
              <Link
                to={l.path}
                style={{
                  display: "flex",
                  alignItems: "center",
                  gap: collapsed ? "0" : "0.75rem",
                  padding: "0.75rem 1rem",
                  borderRadius: "10px",
                  color: active ? "#f97316" : "var(--text-color)",
                  textDecoration: "none",
                  background: active
                    ? "linear-gradient(90deg, rgba(249,115,22,0.25), rgba(249,115,22,0.1))"
                    : "transparent",
                  fontWeight: active ? "600" : "400",
                  transition: "0.25s ease",
                }}
                onMouseEnter={(e) => {
                  e.target.style.background =
                    "linear-gradient(90deg, rgba(249,115,22,0.15), rgba(249,115,22,0.05))";
                  e.target.style.color = "#f97316";
                }}
                onMouseLeave={(e) => {
                  e.target.style.background = active
                    ? "linear-gradient(90deg, rgba(249,115,22,0.25), rgba(249,115,22,0.1))"
                    : "transparent";
                  e.target.style.color = active ? "#f97316" : "var(--text-color)";
                }}
              >
                <span style={{ fontSize: "1.3rem" }}>{l.icon}</span>
                {!collapsed && <span>{l.label}</span>}
              </Link>

              {/* Tooltip when collapsed */}
              {collapsed && <div className="sidebar-tooltip">{l.label}</div>}
            </div>
          );
        })}
      </div>

      <style>
        {`
            .sidebar-tooltip {
                position: absolute;
                left: 80px;
                top: 50%;
                transform: translateY(-50%);
                background: var(--card-bg);
                padding: 6px 10px;
                border-radius: 6px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.25);
                white-space: nowrap;
                opacity: 0;
                pointer-events: none;
                transition: 0.2s ease;
                color: var(--text-color);
                border: 1px solid var(--card-border);
            }
            a:hover + .sidebar-tooltip {
                opacity: 1;
            }
        `}
      </style>
    </aside>
  );
}
</file>

<file path="src/pages/dashboards/InventoryDashboard.jsx">
import React, { useEffect, useState, useContext } from "react";
import api from "../../services/api";
import { AuthContext } from "../../context/AuthContext";
import PageHeader from "../../components/PageHeader";
import Toolbar from "../../components/Toolbar";
import SearchInput from "../../components/SearchInput";
import IconPillButton from "../../components/IconPillButton";
import DataTable from "../../components/DataTable";
import { toast } from "react-toastify";
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  Tooltip,
  PieChart,
  Pie,
  Cell,
  ResponsiveContainer,
  Legend,
} from "recharts";

export default function InventoryDashboard() {
  const { user } = useContext(AuthContext);
  const [inventory, setInventory] = useState([]);
  const [summary, setSummary] = useState({});
  const [search, setSearch] = useState("");
  const [loading, setLoading] = useState(true);

  // üé® Define theme per role
  const roleTheme = {
    dealer: { color: "#3b82f6", bg: "#eff6ff" },
    manager: { color: "#f59e0b", bg: "#fff7ed" },
    inventory: { color: "#22c55e", bg: "#f0fdf4" },
    admin: { color: "#8b5cf6", bg: "#f5f3ff" },
  };

  const theme = roleTheme[user?.role] || { color: "#6b7280", bg: "#f9fafb" };

  const COLORS = ["#22c55e", "#3b82f6", "#f59e0b", "#ef4444", "#8b5cf6"];

  // üì° Fetch inventory data
  const fetchInventory = async () => {
    try {
      setLoading(true);
      const res = await api.get("/inventory/summary");
      setInventory(res.data.inventory || []);
      setSummary(res.data.summary || {});
    } catch (err) {
      toast.error("Failed to load inventory data");
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchInventory();
  }, []);

  const handleExport = async (format) => {
    try {
      const response = await api.get(`/inventory/export?format=${format}`, {
        responseType: "blob",
      });
      const url = window.URL.createObjectURL(new Blob([response.data]));
      const link = document.createElement("a");
      link.href = url;
      link.setAttribute(
        "download",
        `inventory_${new Date().toISOString().slice(0, 10)}.${format === "pdf" ? "pdf" : "xlsx"}`
      );
      document.body.appendChild(link);
      link.click();
    } catch (err) {
      toast.error("Export failed");
    }
  };

  const handleAddMockItem = async () => {
    try {
      const mock = {
        product: "New Product",
        available: Math.floor(Math.random() * 100),
        plant: "Chennai",
        reorderLevel: 10,
      };
      const res = await api.post("/inventory", mock);
      toast.success("Item added");
      setInventory((prev) => [...prev, res.data.item]);
    } catch (err) {
      toast.error("Failed to add item");
    }
  };

  const handleDelete = async (id) => {
    try {
      await api.delete(`/inventory/${id}`);
      toast.success("Item deleted");
      setInventory((prev) => prev.filter((i) => i.id !== id));
    } catch (err) {
      toast.error("Failed to delete item");
    }
  };

  // üîç Filter search
  const filtered = inventory.filter((item) =>
    item.product.toLowerCase().includes(search.toLowerCase())
  );

  // üß± Table columns (role-aware)
  const columns = [
    { key: "product", label: "Product" },
    { key: "available", label: "Available" },
    (user?.role === "manager" || user?.role === "inventory" || user?.role === "admin") && {
      key: "plant",
      label: "Plant",
    },
    (user?.role === "inventory" || user?.role === "admin") && {
      key: "reorderLevel",
      label: "Reorder Level",
    },
    (user?.role === "inventory" || user?.role === "admin") && {
      key: "updatedAt",
      label: "Last Updated",
    },
    (user?.role === "inventory" || user?.role === "admin") && {
      key: "actions",
      label: "Actions",
      render: (_, row) => (
        <button
          onClick={() => handleDelete(row.id)}
          style={{
            border: "none",
            padding: "6px 10px",
            background: "#ef4444",
            color: "white",
            borderRadius: 6,
            cursor: "pointer",
          }}
        >
          Delete
        </button>
      ),
    },
  ].filter(Boolean);

  // üìä Derived data for charts
  const lowStockCount = inventory.filter(
    (i) => i.reorderLevel && i.available < i.reorderLevel
  ).length;

  const plantWiseData = Object.values(
    inventory.reduce((acc, cur) => {
      if (!cur.plant) return acc;
      acc[cur.plant] = acc[cur.plant] || { name: cur.plant, total: 0 };
      acc[cur.plant].total += cur.available;
      return acc;
    }, {})
  );

  return (
    <div style={{ padding: "1rem", background: theme.bg, minHeight: "100vh" }}>
      <PageHeader
        title="Inventory Dashboard"
        subtitle={`Monitor stock and performance ‚Äî role: ${user?.role?.toUpperCase()}`}
        actions={[
          (user?.role !== "dealer") && (
            <IconPillButton
              key="pdf"
              label="Export PDF"
              icon="üìÑ"
              onClick={() => handleExport("pdf")}
            />
          ),
          (user?.role !== "dealer") && (
            <IconPillButton
              key="excel"
              label="Export Excel"
              icon="üìä"
              onClick={() => handleExport("excel")}
              tone="success"
            />
          ),
          (user?.role === "inventory" || user?.role === "admin") && (
            <IconPillButton
              key="add"
              label="Add Mock Item"
              icon="‚ûï"
              onClick={handleAddMockItem}
              tone="warning"
            />
          ),
        ].filter(Boolean)}
      />

      <div
        style={{
          background: theme.color,
          color: "white",
          padding: "0.6rem 1rem",
          borderRadius: 10,
          display: "inline-block",
          marginBottom: "1rem",
        }}
      >
        Logged in as <strong>{user?.role?.toUpperCase()}</strong>
      </div>

      <Toolbar>
        <SearchInput
          placeholder="Search product"
          value={search}
          onChange={(e) => setSearch(e.target.value)}
        />
      </Toolbar>

      {/* üé® Charts */}
      {!loading && inventory.length > 0 && (
        <div
          style={{
            display: "grid",
            gridTemplateColumns: "2fr 1fr",
            gap: "1.5rem",
            marginTop: "2rem",
          }}
        >
          <div
            style={{
              background: "white",
              padding: "1rem",
              borderRadius: "12px",
              boxShadow: "0 2px 8px rgba(0,0,0,0.05)",
            }}
          >
            <h4 style={{ marginBottom: "1rem", color: "#111827" }}>
              üì¶ Stock Levels by Product
            </h4>
            <ResponsiveContainer width="100%" height={300}>
              <BarChart data={inventory}>
                <XAxis dataKey="product" />
                <YAxis />
                <Tooltip />
                <Legend />
                <Bar dataKey="available" fill={theme.color} name="Available Stock" />
                {(user?.role === "inventory" || user?.role === "admin") && (
                  <Bar
                    dataKey="reorderLevel"
                    fill="#f97316"
                    name="Reorder Level"
                  />
                )}
              </BarChart>
            </ResponsiveContainer>
          </div>

          {(user?.role !== "dealer") && (
            <div
              style={{
                background: "white",
                padding: "1rem",
                borderRadius: "12px",
                boxShadow: "0 2px 8px rgba(0,0,0,0.05)",
              }}
            >
              <h4 style={{ marginBottom: "1rem", color: "#111827" }}>
                üè≠ Stock by Plant
              </h4>
              <ResponsiveContainer width="100%" height={300}>
                <PieChart>
                  <Pie
                    data={plantWiseData}
                    dataKey="total"
                    nameKey="name"
                    outerRadius={100}
                    fill={theme.color}
                    label
                  >
                    {plantWiseData.map((_, i) => (
                      <Cell key={i} fill={COLORS[i % COLORS.length]} />
                    ))}
                  </Pie>
                  <Tooltip />
                </PieChart>
              </ResponsiveContainer>
            </div>
          )}
        </div>
      )}

      {/* üìã Table */}
      <div style={{ marginTop: "2rem" }}>
        {loading ? (
          <p style={{ color: "#9ca3af" }}>Loading inventory...</p>
        ) : (
          <DataTable columns={columns} rows={filtered} />
        )}
      </div>

      {/* üìà Summary Cards */}
      <div
        style={{
          marginTop: "2rem",
          display: "flex",
          flexWrap: "wrap",
          gap: "1rem",
        }}
      >
        <div
          style={{
            background: "white",
            padding: "1rem",
            borderRadius: "12px",
            flex: 1,
            minWidth: "200px",
          }}
        >
          <h4 style={{ color: theme.color }}>üìä Summary</h4>
          <p>Total Dealers: {summary.totalDealers}</p>
          <p>Active Campaigns: {summary.activeCampaigns}</p>
          <p>Total Invoices: {summary.totalInvoices}</p>
        </div>
        <div
          style={{
            background: lowStockCount > 0 ? "#fee2e2" : "#dcfce7",
            padding: "1rem",
            borderRadius: "12px",
            flex: 1,
            minWidth: "200px",
          }}
        >
          <h4>‚ö†Ô∏è Low Stock Items</h4>
          <p>
            {lowStockCount > 0
              ? `${lowStockCount} product(s) below reorder level`
              : "All stocks are healthy!"}
          </p>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/dashboards/DealerDashboard.jsx">
import React, { useEffect, useState } from "react";
import api from "../../services/api";
import socket from "../../services/socket";
import { toast } from "react-toastify";
import Card from "../../components/Card";
import StatCard from "../../components/StatCard";
import Toolbar from "../../components/Toolbar";
import SearchInput from "../../components/SearchInput";
import IconPillButton from "../../components/IconPillButton";
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  Legend,
  PieChart,
  Pie,
  Cell,
} from "recharts";
import "./DashboardLayout.css";

export default function DealerDashboard() {
  const [summary, setSummary] = useState({});
  const [invoices, setInvoices] = useState([]);
  const [promotions, setPromotions] = useState([]);
  const [documents, setDocuments] = useState([]);
  const [trend, setTrend] = useState([]);
  const [inventory, setInventory] = useState([]); // üëÄ visible stock data
  const [loading, setLoading] = useState(true);
  const [search, setSearch] = useState("");

  const COLORS = ["#3b82f6", "#60a5fa", "#2563eb", "#1d4ed8", "#93c5fd"];

  // ‚úÖ Fetch Dealer Data
  useEffect(() => {
    const fetchData = async () => {
      try {
        setLoading(true);
        const [summaryRes, invoiceRes, promoRes, docRes, trendRes, inventoryRes] =
          await Promise.all([
            api.get("/reports/dealer-performance"),
            api.get("/invoices"),
            api.get("/campaigns/active"),
            api.get("/documents"),
            api.get("/reports/dealer-performance?trend=true"),
            api.get("/inventory/summary"), // fetch visible stock for dealers
          ]);

        setSummary(summaryRes.data);
        setInvoices(invoiceRes.data.invoices || []);
        setPromotions(promoRes.data || []);
        setDocuments(docRes.data.documents || []);
        setTrend(trendRes.data.trend || []);
        setInventory(inventoryRes.data.inventory || []);
      } catch (err) {
        console.error("Dealer dashboard error:", err);
      } finally {
        setLoading(false);
      }
    };
    fetchData();
  }, []);

  // ‚úÖ Socket Events
  useEffect(() => {
    const token = localStorage.getItem("token");
    if (token) socket.auth = { token };
    socket.connect();

    socket.on("promotion:new", (promo) => {
      toast.success(`üéâ New promotion: ${promo.title}`);
      setPromotions((prev) => [promo, ...prev]);
    });

    socket.on("document:update", (doc) => {
      toast.info(`üìÑ Document ${doc.status}`);
      setDocuments((prev) =>
        prev.map((d) => (d.id === doc.id ? { ...d, status: doc.status } : d))
      );
    });

    socket.on("notification:update", (notif) => {
      toast.info(`üîî ${notif.message || "New update"}`);
    });

    return () => socket.disconnect();
  }, []);

  if (loading)
    return (
      <div className="center text-center" style={{ height: "80vh" }}>
        Loading Dealer Dashboard...
      </div>
    );

  // üé® Dealer theme (blue accents)
  const accent = "#3b82f6";

  return (
    <div className="dashboard-container" style={{ background: "#f9fafb" }}>
      {/* HEADER */}
      <header className="dashboard-header">
        <h1>Dealer Dashboard</h1>
        <p>
          Welcome back,{" "}
          <span style={{ color: accent, fontWeight: 600 }}>
            {summary.dealerName || "Dealer"}
          </span>
        </p>
      </header>

      {/* TOOLBAR */}
      <Toolbar
        left={[
          <SearchInput
            key="search"
            value={search}
            onChange={(e) => setSearch(e.target.value)}
            placeholder="Search invoices or documents..."
          />,
        ]}
        right={[
          <IconPillButton key="upload" icon="üì§" label="Upload" />,
          <IconPillButton
            key="promo"
            icon="üéâ"
            label="Promotions"
            tone="warning"
          />,
        ]}
      />

      {/* KPI SUMMARY */}
      <div className="stat-grid">
        <StatCard
          title="Total Sales"
          value={`‚Çπ${summary.totalSales || 0}`}
          icon="üí∞"
        />
        <StatCard
          title="Invoices"
          value={summary.totalInvoices || 0}
          icon="üßæ"
        />
        <StatCard
          title="Outstanding"
          value={`‚Çπ${summary.outstanding || 0}`}
          icon="‚ö†Ô∏è"
        />
        <StatCard title="Promotions" value={promotions.length} icon="üéâ" />
      </div>

      {/* MAIN GRID */}
      <div className="dashboard-grid">
        {/* LEFT COLUMN */}
        <div className="column">
          {/* Sales Trend Chart */}
          <Card
            title="Sales vs Outstanding (Last 6 Months)"
            className="chart-card"
          >
            <ResponsiveContainer width="100%" height="100%">
              <BarChart data={trend}>
                <CartesianGrid strokeDasharray="3 3" stroke="#e5e7eb" />
                <XAxis dataKey="month" stroke="#6b7280" />
                <YAxis stroke="#6b7280" />
                <Tooltip
                  contentStyle={{
                    background: "#fff",
                    border: "1px solid #e5e7eb",
                    color: "#111827",
                  }}
                />
                <Legend />
                <Bar
                  dataKey="sales"
                  fill={accent}
                  barSize={12}
                  radius={[4, 4, 0, 0]}
                />
                <Bar
                  dataKey="outstanding"
                  fill="#93c5fd"
                  barSize={12}
                  radius={[4, 4, 0, 0]}
                />
              </BarChart>
            </ResponsiveContainer>
          </Card>

          {/* Inventory Visibility for Dealers */}
          <Card title="Stock Availability">
            {inventory.length > 0 ? (
              <ResponsiveContainer width="100%" height={250}>
                <PieChart>
                  <Pie
                    data={inventory}
                    dataKey="available"
                    nameKey="product"
                    outerRadius={100}
                    fill={accent}
                    label
                  >
                    {inventory.map((_, i) => (
                      <Cell key={i} fill={COLORS[i % COLORS.length]} />
                    ))}
                  </Pie>
                  <Tooltip />
                </PieChart>
              </ResponsiveContainer>
            ) : (
              <p className="text-muted">No inventory data available</p>
            )}
          </Card>

          {/* Invoices & Docs */}
          <div className="stat-grid">
            <Card title="Recent Invoices">
              {invoices.length ? (
                <table className="custom-table">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Date</th>
                      <th>‚Çπ</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    {invoices.slice(0, 4).map((i) => (
                      <tr key={i.id}>
                        <td>{i.invoiceNumber}</td>
                        <td>
                          {new Date(i.invoiceDate).toLocaleDateString()}
                        </td>
                        <td>{i.totalAmount}</td>
                        <td
                          className={
                            i.status === "Paid"
                              ? "status-approved"
                              : "status-pending"
                          }
                        >
                          {i.status}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              ) : (
                <p className="text-muted">No invoices found</p>
              )}
            </Card>

            <Card title="Documents">
              {documents.length ? (
                <table className="custom-table">
                  <thead>
                    <tr>
                      <th>File</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    {documents.slice(0, 4).map((d) => (
                      <tr key={d.id}>
                        <td>{d.fileName}</td>
                        <td
                          className={`status-${d.status || "pending"}`}
                        >
                          {d.status}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              ) : (
                <p className="text-muted">No uploaded docs</p>
              )}
            </Card>
          </div>
        </div>

        {/* RIGHT COLUMN */}
        <div className="column">
          <Card title="Active Promotions">
            {promotions.length ? (
              promotions.slice(0, 3).map((promo) => (
                <div
                  key={promo.id}
                  style={{
                    padding: "0.4rem 0",
                    borderBottom: "1px solid #e5e7eb",
                  }}
                >
                  <strong style={{ color: accent }}>{promo.title}</strong>
                  <p className="text-muted">{promo.description}</p>
                  <small className="text-muted">
                    Till {new Date(promo.validTill).toLocaleDateString()}
                  </small>
                </div>
              ))
            ) : (
              <p className="text-muted">No active promotions</p>
            )}
          </Card>

          <div className="quick-actions">
            <IconPillButton icon="üì§" label="Upload" />
            <IconPillButton icon="üìë" label="Statements" />
            <IconPillButton icon="üí¨" label="Contact" tone="success" />
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

</files>
